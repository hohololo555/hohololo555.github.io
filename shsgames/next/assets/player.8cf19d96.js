import{e as Mt,r as Ke,j as ge,h as et,i as Et}from"./client.14a22751.js";var xt=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var a={},y=Symbol("test"),g=Object(y);if(typeof y=="string"||Object.prototype.toString.call(y)!=="[object Symbol]"||Object.prototype.toString.call(g)!=="[object Symbol]")return!1;var v=42;a[y]=v;for(y in a)return!1;if(typeof Object.keys=="function"&&Object.keys(a).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(a).length!==0)return!1;var p=Object.getOwnPropertySymbols(a);if(p.length!==1||p[0]!==y||!Object.prototype.propertyIsEnumerable.call(a,y))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var h=Object.getOwnPropertyDescriptor(a,y);if(h.value!==v||h.enumerable!==!0)return!1}return!0},tt=typeof Symbol<"u"&&Symbol,_t=xt,kt=function(){return typeof tt!="function"||typeof Symbol!="function"||typeof tt("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:_t()},Ft="Function.prototype.bind called on incompatible ",Pe=Array.prototype.slice,It=Object.prototype.toString,Ht="[object Function]",$t=function(a){var y=this;if(typeof y!="function"||It.call(y)!==Ht)throw new TypeError(Ft+y);for(var g=Pe.call(arguments,1),v,p=function(){if(this instanceof v){var e=y.apply(this,g.concat(Pe.call(arguments)));return Object(e)===e?e:this}else return y.apply(a,g.concat(Pe.call(arguments)))},h=Math.max(0,y.length-g.length),t=[],r=0;r<h;r++)t.push("$"+r);if(v=Function("binder","return function ("+t.join(",")+"){ return binder.apply(this,arguments); }")(p),y.prototype){var i=function(){};i.prototype=y.prototype,v.prototype=new i,i.prototype=null}return v},qt=$t,Ve=Function.prototype.bind||qt,Nt=Ve,Ut=Nt.call(Function.call,Object.prototype.hasOwnProperty),O,ve=SyntaxError,yt=Function,ae=TypeError,Te=function(l){try{return yt('"use strict"; return ('+l+").constructor;")()}catch{}},ee=Object.getOwnPropertyDescriptor;if(ee)try{ee({},"")}catch{ee=null}var Le=function(){throw new ae},Wt=ee?function(){try{return arguments.callee,Le}catch{try{return ee(arguments,"callee").get}catch{return Le}}}():Le,ie=kt(),z=Object.getPrototypeOf||function(l){return l.__proto__},ne={},Yt=typeof Uint8Array>"u"?O:z(Uint8Array),se={"%AggregateError%":typeof AggregateError>"u"?O:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?O:ArrayBuffer,"%ArrayIteratorPrototype%":ie?z([][Symbol.iterator]()):O,"%AsyncFromSyncIteratorPrototype%":O,"%AsyncFunction%":ne,"%AsyncGenerator%":ne,"%AsyncGeneratorFunction%":ne,"%AsyncIteratorPrototype%":ne,"%Atomics%":typeof Atomics>"u"?O:Atomics,"%BigInt%":typeof BigInt>"u"?O:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?O:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?O:Float32Array,"%Float64Array%":typeof Float64Array>"u"?O:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?O:FinalizationRegistry,"%Function%":yt,"%GeneratorFunction%":ne,"%Int8Array%":typeof Int8Array>"u"?O:Int8Array,"%Int16Array%":typeof Int16Array>"u"?O:Int16Array,"%Int32Array%":typeof Int32Array>"u"?O:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ie?z(z([][Symbol.iterator]())):O,"%JSON%":typeof JSON=="object"?JSON:O,"%Map%":typeof Map>"u"?O:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ie?O:z(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?O:Promise,"%Proxy%":typeof Proxy>"u"?O:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?O:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?O:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ie?O:z(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?O:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ie?z(""[Symbol.iterator]()):O,"%Symbol%":ie?Symbol:O,"%SyntaxError%":ve,"%ThrowTypeError%":Wt,"%TypedArray%":Yt,"%TypeError%":ae,"%Uint8Array%":typeof Uint8Array>"u"?O:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?O:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?O:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?O:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?O:WeakMap,"%WeakRef%":typeof WeakRef>"u"?O:WeakRef,"%WeakSet%":typeof WeakSet>"u"?O:WeakSet},Vt=function l(a){var y;if(a==="%AsyncFunction%")y=Te("async function () {}");else if(a==="%GeneratorFunction%")y=Te("function* () {}");else if(a==="%AsyncGeneratorFunction%")y=Te("async function* () {}");else if(a==="%AsyncGenerator%"){var g=l("%AsyncGeneratorFunction%");g&&(y=g.prototype)}else if(a==="%AsyncIteratorPrototype%"){var v=l("%AsyncGenerator%");v&&(y=z(v.prototype))}return se[a]=y,y},rt={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ae=Ve,Se=Ut,jt=Ae.call(Function.call,Array.prototype.concat),zt=Ae.call(Function.apply,Array.prototype.splice),it=Ae.call(Function.call,String.prototype.replace),Be=Ae.call(Function.call,String.prototype.slice),Zt=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Gt=/\\(\\)?/g,Jt=function(a){var y=Be(a,0,1),g=Be(a,-1);if(y==="%"&&g!=="%")throw new ve("invalid intrinsic syntax, expected closing `%`");if(g==="%"&&y!=="%")throw new ve("invalid intrinsic syntax, expected opening `%`");var v=[];return it(a,Zt,function(p,h,t,r){v[v.length]=t?it(r,Gt,"$1"):h||p}),v},Xt=function(a,y){var g=a,v;if(Se(rt,g)&&(v=rt[g],g="%"+v[0]+"%"),Se(se,g)){var p=se[g];if(p===ne&&(p=Vt(g)),typeof p>"u"&&!y)throw new ae("intrinsic "+a+" exists, but is not available. Please file an issue!");return{alias:v,name:g,value:p}}throw new ve("intrinsic "+a+" does not exist!")},je=function(a,y){if(typeof a!="string"||a.length===0)throw new ae("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof y!="boolean")throw new ae('"allowMissing" argument must be a boolean');var g=Jt(a),v=g.length>0?g[0]:"",p=Xt("%"+v+"%",y),h=p.name,t=p.value,r=!1,i=p.alias;i&&(v=i[0],zt(g,jt([0,1],i)));for(var e=1,s=!0;e<g.length;e+=1){var n=g[e],d=Be(n,0,1),c=Be(n,-1);if((d==='"'||d==="'"||d==="`"||c==='"'||c==="'"||c==="`")&&d!==c)throw new ve("property names with quotes must have matching quotes");if((n==="constructor"||!s)&&(r=!0),v+="."+n,h="%"+v+"%",Se(se,h))t=se[h];else if(t!=null){if(!(n in t)){if(!y)throw new ae("base intrinsic for "+a+" exists, but the property is not available.");return}if(ee&&e+1>=g.length){var u=ee(t,n);s=!!u,s&&"get"in u&&!("originalValue"in u.get)?t=u.get:t=t[n]}else s=Se(t,n),t=t[n];s&&!r&&(se[h]=t)}}return t},gt={exports:{}};(function(l){var a=Ve,y=je,g=y("%Function.prototype.apply%"),v=y("%Function.prototype.call%"),p=y("%Reflect.apply%",!0)||a.call(v,g),h=y("%Object.getOwnPropertyDescriptor%",!0),t=y("%Object.defineProperty%",!0),r=y("%Math.max%");if(t)try{t({},"a",{value:1})}catch{t=null}l.exports=function(s){var n=p(a,v,arguments);if(h&&t){var d=h(n,"length");d.configurable&&t(n,"length",{value:1+r(0,s.length-(arguments.length-1))})}return n};var i=function(){return p(a,g,arguments)};t?t(l.exports,"apply",{value:i}):l.exports.apply=i})(gt);var ht=je,pt=gt.exports,Qt=pt(ht("String.prototype.indexOf")),Kt=function(a,y){var g=ht(a,!!y);return typeof g=="function"&&Qt(a,".prototype.")>-1?pt(g):g};const er={},tr=Object.freeze(Object.defineProperty({__proto__:null,default:er},Symbol.toStringTag,{value:"Module"})),rr=Mt(tr);var ze=typeof Map=="function"&&Map.prototype,De=Object.getOwnPropertyDescriptor&&ze?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Oe=ze&&De&&typeof De.get=="function"?De.get:null,ir=ze&&Map.prototype.forEach,Ze=typeof Set=="function"&&Set.prototype,Me=Object.getOwnPropertyDescriptor&&Ze?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,we=Ze&&Me&&typeof Me.get=="function"?Me.get:null,nr=Ze&&Set.prototype.forEach,ar=typeof WeakMap=="function"&&WeakMap.prototype,he=ar?WeakMap.prototype.has:null,sr=typeof WeakSet=="function"&&WeakSet.prototype,pe=sr?WeakSet.prototype.has:null,or=typeof WeakRef=="function"&&WeakRef.prototype,nt=or?WeakRef.prototype.deref:null,ur=Boolean.prototype.valueOf,lr=Object.prototype.toString,cr=Function.prototype.toString,fr=String.prototype.match,Ge=String.prototype.slice,G=String.prototype.replace,dr=String.prototype.toUpperCase,at=String.prototype.toLowerCase,mt=RegExp.prototype.test,st=Array.prototype.concat,W=Array.prototype.join,yr=Array.prototype.slice,ot=Math.floor,$e=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Ee=Object.getOwnPropertySymbols,qe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,oe=typeof Symbol=="function"&&typeof Symbol.iterator=="object",F=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===oe?"object":"symbol")?Symbol.toStringTag:null,vt=Object.prototype.propertyIsEnumerable,ut=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(l){return l.__proto__}:null);function lt(l,a){if(l===1/0||l===-1/0||l!==l||l&&l>-1e3&&l<1e3||mt.call(/e/,a))return a;var y=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof l=="number"){var g=l<0?-ot(-l):ot(l);if(g!==l){var v=String(g),p=Ge.call(a,v.length+1);return G.call(v,y,"$&_")+"."+G.call(G.call(p,/([0-9]{3})/g,"$&_"),/_$/,"")}}return G.call(a,y,"$&_")}var xe=rr.custom,_e=xe&&Rt(xe)?xe:null,gr=function l(a,y,g,v){var p=y||{};if(Z(p,"quoteStyle")&&p.quoteStyle!=="single"&&p.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Z(p,"maxStringLength")&&(typeof p.maxStringLength=="number"?p.maxStringLength<0&&p.maxStringLength!==1/0:p.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var h=Z(p,"customInspect")?p.customInspect:!0;if(typeof h!="boolean"&&h!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Z(p,"indent")&&p.indent!==null&&p.indent!=="	"&&!(parseInt(p.indent,10)===p.indent&&p.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Z(p,"numericSeparator")&&typeof p.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var t=p.numericSeparator;if(typeof a>"u")return"undefined";if(a===null)return"null";if(typeof a=="boolean")return a?"true":"false";if(typeof a=="string")return St(a,p);if(typeof a=="number"){if(a===0)return 1/0/a>0?"0":"-0";var r=String(a);return t?lt(a,r):r}if(typeof a=="bigint"){var i=String(a)+"n";return t?lt(a,i):i}var e=typeof p.depth>"u"?5:p.depth;if(typeof g>"u"&&(g=0),g>=e&&e>0&&typeof a=="object")return Ne(a)?"[Array]":"[Object]";var s=xr(p,g);if(typeof v>"u")v=[];else if(Ct(v,a)>=0)return"[Circular]";function n(A,R,P){if(R&&(v=yr.call(v),v.push(R)),P){var M={depth:p.depth};return Z(p,"quoteStyle")&&(M.quoteStyle=p.quoteStyle),l(A,M,g+1,v)}return l(A,p,g+1,v)}if(typeof a=="function"){var d=Or(a),c=be(a,n);return"[Function"+(d?": "+d:" (anonymous)")+"]"+(c.length>0?" { "+W.call(c,", ")+" }":"")}if(Rt(a)){var u=oe?G.call(String(a),/^(Symbol\(.*\))_[^)]*$/,"$1"):qe.call(a);return typeof a=="object"&&!oe?ye(u):u}if(Dr(a)){for(var f="<"+at.call(String(a.nodeName)),o=a.attributes||[],m=0;m<o.length;m++)f+=" "+o[m].name+"="+bt(hr(o[m].value),"double",p);return f+=">",a.childNodes&&a.childNodes.length&&(f+="..."),f+="</"+at.call(String(a.nodeName))+">",f}if(Ne(a)){if(a.length===0)return"[]";var b=be(a,n);return s&&!Er(b)?"["+Ue(b,s)+"]":"[ "+W.call(b,", ")+" ]"}if(vr(a)){var T=be(a,n);return"cause"in a&&!vt.call(a,"cause")?"{ ["+String(a)+"] "+W.call(st.call("[cause]: "+n(a.cause),T),", ")+" }":T.length===0?"["+String(a)+"]":"{ ["+String(a)+"] "+W.call(T,", ")+" }"}if(typeof a=="object"&&h){if(_e&&typeof a[_e]=="function")return a[_e]();if(h!=="symbol"&&typeof a.inspect=="function")return a.inspect()}if(wr(a)){var S=[];return ir.call(a,function(A,R){S.push(n(R,a,!0)+" => "+n(A,a))}),ct("Map",Oe.call(a),S,s)}if(Tr(a)){var _=[];return nr.call(a,function(A){_.push(n(A,a))}),ct("Set",we.call(a),_,s)}if(Ar(a))return ke("WeakMap");if(Lr(a))return ke("WeakSet");if(Pr(a))return ke("WeakRef");if(Rr(a))return ye(n(Number(a)));if(Sr(a))return ye(n($e.call(a)));if(Cr(a))return ye(ur.call(a));if(br(a))return ye(n(String(a)));if(!pr(a)&&!mr(a)){var D=be(a,n),I=ut?ut(a)===Object.prototype:a instanceof Object||a.constructor===Object,C=a instanceof Object?"":"null prototype",N=!I&&F&&Object(a)===a&&F in a?Ge.call(J(a),8,-1):C?"Object":"",w=I||typeof a.constructor!="function"?"":a.constructor.name?a.constructor.name+" ":"",B=w+(N||C?"["+W.call(st.call([],N||[],C||[]),": ")+"] ":"");return D.length===0?B+"{}":s?B+"{"+Ue(D,s)+"}":B+"{ "+W.call(D,", ")+" }"}return String(a)};function bt(l,a,y){var g=(y.quoteStyle||a)==="double"?'"':"'";return g+l+g}function hr(l){return G.call(String(l),/"/g,"&quot;")}function Ne(l){return J(l)==="[object Array]"&&(!F||!(typeof l=="object"&&F in l))}function pr(l){return J(l)==="[object Date]"&&(!F||!(typeof l=="object"&&F in l))}function mr(l){return J(l)==="[object RegExp]"&&(!F||!(typeof l=="object"&&F in l))}function vr(l){return J(l)==="[object Error]"&&(!F||!(typeof l=="object"&&F in l))}function br(l){return J(l)==="[object String]"&&(!F||!(typeof l=="object"&&F in l))}function Rr(l){return J(l)==="[object Number]"&&(!F||!(typeof l=="object"&&F in l))}function Cr(l){return J(l)==="[object Boolean]"&&(!F||!(typeof l=="object"&&F in l))}function Rt(l){if(oe)return l&&typeof l=="object"&&l instanceof Symbol;if(typeof l=="symbol")return!0;if(!l||typeof l!="object"||!qe)return!1;try{return qe.call(l),!0}catch{}return!1}function Sr(l){if(!l||typeof l!="object"||!$e)return!1;try{return $e.call(l),!0}catch{}return!1}var Br=Object.prototype.hasOwnProperty||function(l){return l in this};function Z(l,a){return Br.call(l,a)}function J(l){return lr.call(l)}function Or(l){if(l.name)return l.name;var a=fr.call(cr.call(l),/^function\s*([\w$]+)/);return a?a[1]:null}function Ct(l,a){if(l.indexOf)return l.indexOf(a);for(var y=0,g=l.length;y<g;y++)if(l[y]===a)return y;return-1}function wr(l){if(!Oe||!l||typeof l!="object")return!1;try{Oe.call(l);try{we.call(l)}catch{return!0}return l instanceof Map}catch{}return!1}function Ar(l){if(!he||!l||typeof l!="object")return!1;try{he.call(l,he);try{pe.call(l,pe)}catch{return!0}return l instanceof WeakMap}catch{}return!1}function Pr(l){if(!nt||!l||typeof l!="object")return!1;try{return nt.call(l),!0}catch{}return!1}function Tr(l){if(!we||!l||typeof l!="object")return!1;try{we.call(l);try{Oe.call(l)}catch{return!0}return l instanceof Set}catch{}return!1}function Lr(l){if(!pe||!l||typeof l!="object")return!1;try{pe.call(l,pe);try{he.call(l,he)}catch{return!0}return l instanceof WeakSet}catch{}return!1}function Dr(l){return!l||typeof l!="object"?!1:typeof HTMLElement<"u"&&l instanceof HTMLElement?!0:typeof l.nodeName=="string"&&typeof l.getAttribute=="function"}function St(l,a){if(l.length>a.maxStringLength){var y=l.length-a.maxStringLength,g="... "+y+" more character"+(y>1?"s":"");return St(Ge.call(l,0,a.maxStringLength),a)+g}var v=G.call(G.call(l,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Mr);return bt(v,"single",a)}function Mr(l){var a=l.charCodeAt(0),y={8:"b",9:"t",10:"n",12:"f",13:"r"}[a];return y?"\\"+y:"\\x"+(a<16?"0":"")+dr.call(a.toString(16))}function ye(l){return"Object("+l+")"}function ke(l){return l+" { ? }"}function ct(l,a,y,g){var v=g?Ue(y,g):W.call(y,", ");return l+" ("+a+") {"+v+"}"}function Er(l){for(var a=0;a<l.length;a++)if(Ct(l[a],`
`)>=0)return!1;return!0}function xr(l,a){var y;if(l.indent==="	")y="	";else if(typeof l.indent=="number"&&l.indent>0)y=W.call(Array(l.indent+1)," ");else return null;return{base:y,prev:W.call(Array(a+1),y)}}function Ue(l,a){if(l.length===0)return"";var y=`
`+a.prev+a.base;return y+W.call(l,","+y)+`
`+a.prev}function be(l,a){var y=Ne(l),g=[];if(y){g.length=l.length;for(var v=0;v<l.length;v++)g[v]=Z(l,v)?a(l[v],l):""}var p=typeof Ee=="function"?Ee(l):[],h;if(oe){h={};for(var t=0;t<p.length;t++)h["$"+p[t]]=p[t]}for(var r in l)!Z(l,r)||y&&String(Number(r))===r&&r<l.length||oe&&h["$"+r]instanceof Symbol||(mt.call(/[^\w$]/,r)?g.push(a(r,l)+": "+a(l[r],l)):g.push(r+": "+a(l[r],l)));if(typeof Ee=="function")for(var i=0;i<p.length;i++)vt.call(l,p[i])&&g.push("["+a(p[i])+"]: "+a(l[p[i]],l));return g}var Je=je,le=Kt,_r=gr,kr=Je("%TypeError%"),Re=Je("%WeakMap%",!0),Ce=Je("%Map%",!0),Fr=le("WeakMap.prototype.get",!0),Ir=le("WeakMap.prototype.set",!0),Hr=le("WeakMap.prototype.has",!0),$r=le("Map.prototype.get",!0),qr=le("Map.prototype.set",!0),Nr=le("Map.prototype.has",!0),Xe=function(l,a){for(var y=l,g;(g=y.next)!==null;y=g)if(g.key===a)return y.next=g.next,g.next=l.next,l.next=g,g},Ur=function(l,a){var y=Xe(l,a);return y&&y.value},Wr=function(l,a,y){var g=Xe(l,a);g?g.value=y:l.next={key:a,next:l.next,value:y}},Yr=function(l,a){return!!Xe(l,a)},Vr=function(){var a,y,g,v={assert:function(p){if(!v.has(p))throw new kr("Side channel does not contain "+_r(p))},get:function(p){if(Re&&p&&(typeof p=="object"||typeof p=="function")){if(a)return Fr(a,p)}else if(Ce){if(y)return $r(y,p)}else if(g)return Ur(g,p)},has:function(p){if(Re&&p&&(typeof p=="object"||typeof p=="function")){if(a)return Hr(a,p)}else if(Ce){if(y)return Nr(y,p)}else if(g)return Yr(g,p);return!1},set:function(p,h){Re&&p&&(typeof p=="object"||typeof p=="function")?(a||(a=new Re),Ir(a,p,h)):Ce?(y||(y=new Ce),qr(y,p,h)):(g||(g={key:{},next:null}),Wr(g,p,h))}};return v},jr=String.prototype.replace,zr=/%20/g,Fe={RFC1738:"RFC1738",RFC3986:"RFC3986"},Qe={default:Fe.RFC3986,formatters:{RFC1738:function(l){return jr.call(l,zr,"+")},RFC3986:function(l){return String(l)}},RFC1738:Fe.RFC1738,RFC3986:Fe.RFC3986},Zr=Qe,Ie=Object.prototype.hasOwnProperty,K=Array.isArray,U=function(){for(var l=[],a=0;a<256;++a)l.push("%"+((a<16?"0":"")+a.toString(16)).toUpperCase());return l}(),Gr=function(a){for(;a.length>1;){var y=a.pop(),g=y.obj[y.prop];if(K(g)){for(var v=[],p=0;p<g.length;++p)typeof g[p]<"u"&&v.push(g[p]);y.obj[y.prop]=v}}},Bt=function(a,y){for(var g=y&&y.plainObjects?Object.create(null):{},v=0;v<a.length;++v)typeof a[v]<"u"&&(g[v]=a[v]);return g},Jr=function l(a,y,g){if(!y)return a;if(typeof y!="object"){if(K(a))a.push(y);else if(a&&typeof a=="object")(g&&(g.plainObjects||g.allowPrototypes)||!Ie.call(Object.prototype,y))&&(a[y]=!0);else return[a,y];return a}if(!a||typeof a!="object")return[a].concat(y);var v=a;return K(a)&&!K(y)&&(v=Bt(a,g)),K(a)&&K(y)?(y.forEach(function(p,h){if(Ie.call(a,h)){var t=a[h];t&&typeof t=="object"&&p&&typeof p=="object"?a[h]=l(t,p,g):a.push(p)}else a[h]=p}),a):Object.keys(y).reduce(function(p,h){var t=y[h];return Ie.call(p,h)?p[h]=l(p[h],t,g):p[h]=t,p},v)},Xr=function(a,y){return Object.keys(y).reduce(function(g,v){return g[v]=y[v],g},a)},Qr=function(l,a,y){var g=l.replace(/\+/g," ");if(y==="iso-8859-1")return g.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(g)}catch{return g}},Kr=function(a,y,g,v,p){if(a.length===0)return a;var h=a;if(typeof a=="symbol"?h=Symbol.prototype.toString.call(a):typeof a!="string"&&(h=String(a)),g==="iso-8859-1")return escape(h).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var t="",r=0;r<h.length;++r){var i=h.charCodeAt(r);if(i===45||i===46||i===95||i===126||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122||p===Zr.RFC1738&&(i===40||i===41)){t+=h.charAt(r);continue}if(i<128){t=t+U[i];continue}if(i<2048){t=t+(U[192|i>>6]+U[128|i&63]);continue}if(i<55296||i>=57344){t=t+(U[224|i>>12]+U[128|i>>6&63]+U[128|i&63]);continue}r+=1,i=65536+((i&1023)<<10|h.charCodeAt(r)&1023),t+=U[240|i>>18]+U[128|i>>12&63]+U[128|i>>6&63]+U[128|i&63]}return t},ei=function(a){for(var y=[{obj:{o:a},prop:"o"}],g=[],v=0;v<y.length;++v)for(var p=y[v],h=p.obj[p.prop],t=Object.keys(h),r=0;r<t.length;++r){var i=t[r],e=h[i];typeof e=="object"&&e!==null&&g.indexOf(e)===-1&&(y.push({obj:h,prop:i}),g.push(e))}return Gr(y),a},ti=function(a){return Object.prototype.toString.call(a)==="[object RegExp]"},ri=function(a){return!a||typeof a!="object"?!1:!!(a.constructor&&a.constructor.isBuffer&&a.constructor.isBuffer(a))},ii=function(a,y){return[].concat(a,y)},ni=function(a,y){if(K(a)){for(var g=[],v=0;v<a.length;v+=1)g.push(y(a[v]));return g}return y(a)},Ot={arrayToObject:Bt,assign:Xr,combine:ii,compact:ei,decode:Qr,encode:Kr,isBuffer:ri,isRegExp:ti,maybeMap:ni,merge:Jr},wt=Vr,We=Ot,me=Qe,ai=Object.prototype.hasOwnProperty,ft={brackets:function(a){return a+"[]"},comma:"comma",indices:function(a,y){return a+"["+y+"]"},repeat:function(a){return a}},j=Array.isArray,si=String.prototype.split,oi=Array.prototype.push,At=function(l,a){oi.apply(l,j(a)?a:[a])},ui=Date.prototype.toISOString,dt=me.default,x={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:We.encode,encodeValuesOnly:!1,format:dt,formatter:me.formatters[dt],indices:!1,serializeDate:function(a){return ui.call(a)},skipNulls:!1,strictNullHandling:!1},li=function(a){return typeof a=="string"||typeof a=="number"||typeof a=="boolean"||typeof a=="symbol"||typeof a=="bigint"},He={},ci=function l(a,y,g,v,p,h,t,r,i,e,s,n,d,c,u,f){for(var o=a,m=f,b=0,T=!1;(m=m.get(He))!==void 0&&!T;){var S=m.get(a);if(b+=1,typeof S<"u"){if(S===b)throw new RangeError("Cyclic object value");T=!0}typeof m.get(He)>"u"&&(b=0)}if(typeof r=="function"?o=r(y,o):o instanceof Date?o=s(o):g==="comma"&&j(o)&&(o=We.maybeMap(o,function(H){return H instanceof Date?s(H):H})),o===null){if(p)return t&&!c?t(y,x.encoder,u,"key",n):y;o=""}if(li(o)||We.isBuffer(o)){if(t){var _=c?y:t(y,x.encoder,u,"key",n);if(g==="comma"&&c){for(var D=si.call(String(o),","),I="",C=0;C<D.length;++C)I+=(C===0?"":",")+d(t(D[C],x.encoder,u,"value",n));return[d(_)+(v&&j(o)&&D.length===1?"[]":"")+"="+I]}return[d(_)+"="+d(t(o,x.encoder,u,"value",n))]}return[d(y)+"="+d(String(o))]}var N=[];if(typeof o>"u")return N;var w;if(g==="comma"&&j(o))w=[{value:o.length>0?o.join(",")||null:void 0}];else if(j(r))w=r;else{var B=Object.keys(o);w=i?B.sort(i):B}for(var A=v&&j(o)&&o.length===1?y+"[]":y,R=0;R<w.length;++R){var P=w[R],M=typeof P=="object"&&typeof P.value<"u"?P.value:o[P];if(!(h&&M===null)){var k=j(o)?typeof g=="function"?g(A,P):A:A+(e?"."+P:"["+P+"]");f.set(a,b);var L=wt();L.set(He,f),At(N,l(M,k,g,v,p,h,t,r,i,e,s,n,d,c,u,L))}}return N},fi=function(a){if(!a)return x;if(a.encoder!==null&&typeof a.encoder<"u"&&typeof a.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=a.charset||x.charset;if(typeof a.charset<"u"&&a.charset!=="utf-8"&&a.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var g=me.default;if(typeof a.format<"u"){if(!ai.call(me.formatters,a.format))throw new TypeError("Unknown format option provided.");g=a.format}var v=me.formatters[g],p=x.filter;return(typeof a.filter=="function"||j(a.filter))&&(p=a.filter),{addQueryPrefix:typeof a.addQueryPrefix=="boolean"?a.addQueryPrefix:x.addQueryPrefix,allowDots:typeof a.allowDots>"u"?x.allowDots:!!a.allowDots,charset:y,charsetSentinel:typeof a.charsetSentinel=="boolean"?a.charsetSentinel:x.charsetSentinel,delimiter:typeof a.delimiter>"u"?x.delimiter:a.delimiter,encode:typeof a.encode=="boolean"?a.encode:x.encode,encoder:typeof a.encoder=="function"?a.encoder:x.encoder,encodeValuesOnly:typeof a.encodeValuesOnly=="boolean"?a.encodeValuesOnly:x.encodeValuesOnly,filter:p,format:g,formatter:v,serializeDate:typeof a.serializeDate=="function"?a.serializeDate:x.serializeDate,skipNulls:typeof a.skipNulls=="boolean"?a.skipNulls:x.skipNulls,sort:typeof a.sort=="function"?a.sort:null,strictNullHandling:typeof a.strictNullHandling=="boolean"?a.strictNullHandling:x.strictNullHandling}},di=function(l,a){var y=l,g=fi(a),v,p;typeof g.filter=="function"?(p=g.filter,y=p("",y)):j(g.filter)&&(p=g.filter,v=p);var h=[];if(typeof y!="object"||y===null)return"";var t;a&&a.arrayFormat in ft?t=a.arrayFormat:a&&"indices"in a?t=a.indices?"indices":"repeat":t="indices";var r=ft[t];if(a&&"commaRoundTrip"in a&&typeof a.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var i=r==="comma"&&a&&a.commaRoundTrip;v||(v=Object.keys(y)),g.sort&&v.sort(g.sort);for(var e=wt(),s=0;s<v.length;++s){var n=v[s];g.skipNulls&&y[n]===null||At(h,ci(y[n],n,r,i,g.strictNullHandling,g.skipNulls,g.encode?g.encoder:null,g.filter,g.sort,g.allowDots,g.serializeDate,g.format,g.formatter,g.encodeValuesOnly,g.charset,e))}var d=h.join(g.delimiter),c=g.addQueryPrefix===!0?"?":"";return g.charsetSentinel&&(g.charset==="iso-8859-1"?c+="utf8=%26%2310003%3B&":c+="utf8=%E2%9C%93&"),d.length>0?c+d:""},ue=Ot,Ye=Object.prototype.hasOwnProperty,yi=Array.isArray,E={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:ue.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},gi=function(l){return l.replace(/&#(\d+);/g,function(a,y){return String.fromCharCode(parseInt(y,10))})},Pt=function(l,a){return l&&typeof l=="string"&&a.comma&&l.indexOf(",")>-1?l.split(","):l},hi="utf8=%26%2310003%3B",pi="utf8=%E2%9C%93",mi=function(a,y){var g={},v=y.ignoreQueryPrefix?a.replace(/^\?/,""):a,p=y.parameterLimit===1/0?void 0:y.parameterLimit,h=v.split(y.delimiter,p),t=-1,r,i=y.charset;if(y.charsetSentinel)for(r=0;r<h.length;++r)h[r].indexOf("utf8=")===0&&(h[r]===pi?i="utf-8":h[r]===hi&&(i="iso-8859-1"),t=r,r=h.length);for(r=0;r<h.length;++r)if(r!==t){var e=h[r],s=e.indexOf("]="),n=s===-1?e.indexOf("="):s+1,d,c;n===-1?(d=y.decoder(e,E.decoder,i,"key"),c=y.strictNullHandling?null:""):(d=y.decoder(e.slice(0,n),E.decoder,i,"key"),c=ue.maybeMap(Pt(e.slice(n+1),y),function(u){return y.decoder(u,E.decoder,i,"value")})),c&&y.interpretNumericEntities&&i==="iso-8859-1"&&(c=gi(c)),e.indexOf("[]=")>-1&&(c=yi(c)?[c]:c),Ye.call(g,d)?g[d]=ue.combine(g[d],c):g[d]=c}return g},vi=function(l,a,y,g){for(var v=g?a:Pt(a,y),p=l.length-1;p>=0;--p){var h,t=l[p];if(t==="[]"&&y.parseArrays)h=[].concat(v);else{h=y.plainObjects?Object.create(null):{};var r=t.charAt(0)==="["&&t.charAt(t.length-1)==="]"?t.slice(1,-1):t,i=parseInt(r,10);!y.parseArrays&&r===""?h={0:v}:!isNaN(i)&&t!==r&&String(i)===r&&i>=0&&y.parseArrays&&i<=y.arrayLimit?(h=[],h[i]=v):r!=="__proto__"&&(h[r]=v)}v=h}return v},bi=function(a,y,g,v){if(!!a){var p=g.allowDots?a.replace(/\.([^.[]+)/g,"[$1]"):a,h=/(\[[^[\]]*])/,t=/(\[[^[\]]*])/g,r=g.depth>0&&h.exec(p),i=r?p.slice(0,r.index):p,e=[];if(i){if(!g.plainObjects&&Ye.call(Object.prototype,i)&&!g.allowPrototypes)return;e.push(i)}for(var s=0;g.depth>0&&(r=t.exec(p))!==null&&s<g.depth;){if(s+=1,!g.plainObjects&&Ye.call(Object.prototype,r[1].slice(1,-1))&&!g.allowPrototypes)return;e.push(r[1])}return r&&e.push("["+p.slice(r.index)+"]"),vi(e,y,g,v)}},Ri=function(a){if(!a)return E;if(a.decoder!==null&&a.decoder!==void 0&&typeof a.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof a.charset<"u"&&a.charset!=="utf-8"&&a.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var y=typeof a.charset>"u"?E.charset:a.charset;return{allowDots:typeof a.allowDots>"u"?E.allowDots:!!a.allowDots,allowPrototypes:typeof a.allowPrototypes=="boolean"?a.allowPrototypes:E.allowPrototypes,allowSparse:typeof a.allowSparse=="boolean"?a.allowSparse:E.allowSparse,arrayLimit:typeof a.arrayLimit=="number"?a.arrayLimit:E.arrayLimit,charset:y,charsetSentinel:typeof a.charsetSentinel=="boolean"?a.charsetSentinel:E.charsetSentinel,comma:typeof a.comma=="boolean"?a.comma:E.comma,decoder:typeof a.decoder=="function"?a.decoder:E.decoder,delimiter:typeof a.delimiter=="string"||ue.isRegExp(a.delimiter)?a.delimiter:E.delimiter,depth:typeof a.depth=="number"||a.depth===!1?+a.depth:E.depth,ignoreQueryPrefix:a.ignoreQueryPrefix===!0,interpretNumericEntities:typeof a.interpretNumericEntities=="boolean"?a.interpretNumericEntities:E.interpretNumericEntities,parameterLimit:typeof a.parameterLimit=="number"?a.parameterLimit:E.parameterLimit,parseArrays:a.parseArrays!==!1,plainObjects:typeof a.plainObjects=="boolean"?a.plainObjects:E.plainObjects,strictNullHandling:typeof a.strictNullHandling=="boolean"?a.strictNullHandling:E.strictNullHandling}},Ci=function(l,a){var y=Ri(a);if(l===""||l===null||typeof l>"u")return y.plainObjects?Object.create(null):{};for(var g=typeof l=="string"?mi(l,y):l,v=y.plainObjects?Object.create(null):{},p=Object.keys(g),h=0;h<p.length;++h){var t=p[h],r=bi(t,g[t],y,typeof l=="string");v=ue.merge(v,r,y)}return y.allowSparse===!0?v:ue.compact(v)},Si=di,Bi=Ci,Oi=Qe,wi={formats:Oi,parse:Bi,stringify:Si},Tt={exports:{}};(function(l,a){(function(y,g){l.exports=g()})(self,function(){return(()=>{var y={6509:(h,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i=`// Ring buffer reader class declared in the same file as the node since presently native js imports aren't supported\r
// in worklet modules. There's probably a way with webpack bundling but just leaving it here for now. Actual node below.\r
class RingBufferReader {\r
  constructor(sharedArrayBuffer, type) {\r
    this.capacity = (sharedArrayBuffer.byteLength - 8) / type.BYTES_PER_ELEMENT;\r
    this.buf = sharedArrayBuffer;\r
    this.writePointer = new Uint32Array(this.buf, 0, 1);\r
    this.readPointer = new Uint32Array(this.buf, 4, 1);\r
    this.storage = new type(this.buf, 8, this.capacity);\r
  }\r
\r
  pop(elements) {\r
    const read = Atomics.load(this.readPointer, 0);\r
    const write = Atomics.load(this.writePointer, 0);\r
\r
    const availableToRead = this.availableRead(read, write);\r
\r
    if (availableToRead === 0) {\r
      return 0;\r
    }\r
\r
    // Allows circular writing to array. Usually only the first call to copy is called, but if we are near the end\r
    // of the array, the first copy writes up to the end, then the second copy writes the remainder at the start\r
    const howManyToRead = Math.min(availableToRead, elements.length);\r
    let sizeUpToEndOfArray = Math.min(this.capacity - read, howManyToRead);\r
    let sizeFromStartOfTheArrayOrZero = howManyToRead - sizeUpToEndOfArray;\r
\r
    this.copy(this.storage, read, elements, 0, sizeUpToEndOfArray);\r
    this.copy(this.storage, 0, elements, sizeUpToEndOfArray, sizeFromStartOfTheArrayOrZero);\r
\r
    const readPointerPositionAfterRead = (read + howManyToRead) % this.capacity;\r
    Atomics.store(this.readPointer, 0, readPointerPositionAfterRead);\r
\r
    return howManyToRead;\r
  }\r
\r
  isEmpty() {\r
    const readPosition = Atomics.load(this.readPointer, 0);\r
    const writePosition = Atomics.load(this.writePointer, 0);\r
\r
    return writePosition === readPosition;\r
  }\r
\r
  dequeue(byteArray) {\r
    if (this.isEmpty()) {\r
      return 0;\r
    }\r
    return this.pop(byteArray);\r
  }\r
\r
  availableRead(readPosition, writePosition) {\r
    if (writePosition > readPosition) {\r
      return writePosition - readPosition;\r
    } else {\r
      return writePosition + this.capacity - readPosition;\r
    }\r
  }\r
\r
  copy(input, inputOffset, output, outputOffset, size) {\r
    for (let i = 0; i < size; i++) {\r
      output[outputOffset + i] = input[inputOffset + i];\r
    }\r
  }\r
}\r
\r
// Plays audio from its audio queue shared array buffer. Also allows parameters to be changed via index.\r
// Currently parameter changes aren't used, but might be in the future. Current implementation supports gain, but\r
// for gameboy that is determined by the gameboy logic itself.\r
class RingBufferProcessor extends AudioWorkletProcessor {\r
  static get parameterDescriptors() {\r
    return [];\r
  }\r
\r
  constructor(options) {\r
    super(options);\r
\r
    const parameterIndexByteSize = 1;\r
    const parameterValueByteSize = 4;\r
    const arrayBufferSize = parameterIndexByteSize + parameterValueByteSize;\r
    this.rawStorage = new ArrayBuffer(arrayBufferSize);\r
    this.byteArray = new Uint8Array(this.rawStorage);\r
    this.dataView = new DataView(this.rawStorage);\r
\r
    this.interleaved = new Float32Array(128);\r
    this.amp = 1.0;\r
    this.parameterObject = { index: 0, value: 0 };\r
    const { audioQueue, paramQueue } = options.processorOptions;\r
    this.audioReadBuffer = new RingBufferReader(audioQueue, Float32Array);\r
    this.paramReadBuffer = new RingBufferReader(paramQueue, Uint8Array);\r
  }\r
\r
  dequeueParameterChange() {\r
    if (this.paramReadBuffer.isEmpty()) {\r
      return false;\r
    }\r
    this.paramReadBuffer.pop(this.byteArray);\r
    this.parameterObject.index = this.dataView.getUint8(0);\r
    this.parameterObject.value = this.dataView.getFloat32(1);\r
\r
    return true;\r
  }\r
\r
  process(inputs, outputs) {\r
    // Get any param changes\r
    if (this.dequeueParameterChange(this.parameterObject)) {\r
      console.log("param change: ", this.parameterObject.index, this.parameterObject.value);\r
      this.amp = this.parameterObject.value;\r
    }\r
\r
    this.audioReadBuffer.dequeue(this.interleaved);\r
\r
    for (var i = 0; i < 128; i++) {\r
      outputs[0][0][i] = this.amp * this.interleaved[i]\r
    }\r
\r
    return true;\r
  }\r
}\r
\r
registerProcessor('ring-buffer-processor', RingBufferProcessor);\r
`},5991:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.APU=void 0;const i=r(9145),e=r(8107),s=r(1710),n=r(6283),d=r(3893),c=r(3210);class u{constructor(){this.FrameSequencerInterval=i.CPU.OperatingHertz/u.FrameSequencerHertz,this.audioContext=new AudioContext({sampleRate:44100}),this.frameSequencerCycleCounter=0,this.cyclesPerSample=i.CPU.OperatingHertz/this.audioContext.sampleRate,this.sampleCycleCounter=0,this._isAudioEnabled=!1,this.frameSequencerStep=0,this.audioContext.suspend();try{SharedArrayBuffer}catch{console.log("%cAudio requires SharedArrayBuffer","font-family:sans-serif; font-size: 20px"),console.log("This emulator uses a SharedArrayBuffer for buffered audio on a separate thread. To use shared array buffer you must use https and add the following headers to your server:"),console.log(`%c'Cross-Origin-Opener-Policy': 'same-origin', 
'Cross-Origin-Embedder-Policy': 'require-corp'`,"font-family:monospace;")}this.ringBufferPlayer=new c.RingBufferPlayer(this.audioContext,1024),this.sound1=new e.Sound1,this.sound2=new s.Sound2,this.sound3=new d.Sound3,this.sound4=new n.Sound4}get isAudioEnabled(){return this._isAudioEnabled}enableSound(){this._isAudioEnabled=!0,this.audioContext.resume()}disableSound(){this._isAudioEnabled=!1,this.audioContext.suspend()}tick(o){this._isAudioEnabled&&(this.sound1.tick(o),this.sound2.tick(o),this.sound3.tick(o),this.sound4.tick(o),this.sampleCycleCounter+=o,this.sampleCycleCounter>=this.cyclesPerSample&&(this.sampleChannels(),this.sampleCycleCounter-=this.cyclesPerSample),this.frameSequencerCycleCounter+=o,this.frameSequencerCycleCounter>=this.FrameSequencerInterval&&(this.advanceFrameSequencer(),this.frameSequencerCycleCounter-=this.FrameSequencerInterval))}sampleChannels(){const o=(this.sound1.getSample()+this.sound2.getSample()+this.sound3.getSample()+this.sound4.getSample())/4;this.ringBufferPlayer.writeSample(o)}advanceFrameSequencer(){switch(this.frameSequencerStep){case 0:this.clockLength();break;case 2:this.clockLength(),this.clockSweep();break;case 4:this.clockLength();break;case 6:this.clockLength(),this.clockSweep();break;case 7:this.clockVolume()}this.frameSequencerStep++,this.frameSequencerStep===8&&(this.frameSequencerStep=0)}clockLength(){this.sound1.clockLength(),this.sound2.clockLength(),this.sound3.clockLength(),this.sound4.clockLength()}clockSweep(){this.sound1.clockSweep()}clockVolume(){this.sound1.clockVolume(),this.sound2.clockVolume(),this.sound4.clockVolume()}}t.APU=u,u.FrameSequencerHertz=512},7637:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Enveloper=void 0,t.Enveloper=class{constructor(){this.envelopePeriodTimer=0}initializeTimer(r){this.envelopePeriodTimer=r}clockVolume(r,i){const{lengthOfEnvelopeStep:e,isEnvelopeRising:s}=i;if(e===0)return r;if(this.envelopePeriodTimer>0&&this.envelopePeriodTimer--,this.envelopePeriodTimer===0){if(this.envelopePeriodTimer=e,s&&r<15)return r+1;if(!s&&r>0)return r-1}return r}}},8343:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4EnvelopeControlRegister=t.sound2EnvelopeControlRegister=t.sound1EnvelopeControlRegister=t.EnvelopeControlRegister=void 0;const i=r(8254);class e{constructor(n,d){this.offset=n,this.name=d}get value(){return i.memory.readByte(this.offset)}get initialVolume(){return this.value>>4}get isEnvelopeRising(){return(this.value>>3&1)==1}get lengthOfEnvelopeStep(){return 7&this.value}}t.EnvelopeControlRegister=e,t.sound1EnvelopeControlRegister=new e(65298,"NR12"),t.sound2EnvelopeControlRegister=new e(65303,"NR22"),t.sound4EnvelopeControlRegister=new e(65313,"NR42")},9550:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3HighOrderFrequencyRegister=t.sound2HighOrderFrequencyRegister=t.sound1HighOrderFrequencyRegister=t.HighOrderFrequencyRegister=void 0;const i=r(5425),e=r(8254);class s{constructor(d,c){this.offset=d,this.name=c}get value(){return e.memory.readByte(this.offset)}get highOrderFrequencyRegister(){return this.value}get isInitialize(){return this.value>>7==1}set isInitialize(d){const c=i.setBit(this.value,7,d?1:0);e.memory.writeByte(this.offset,c)}get isContinuousSelection(){return(this.value>>6&1)==0}get highOrderFrequencyData(){return 7&this.value}}t.HighOrderFrequencyRegister=s,t.sound1HighOrderFrequencyRegister=new s(65300,"NR14"),t.sound2HighOrderFrequencyRegister=new s(65305,"NR24"),t.sound3HighOrderFrequencyRegister=new s(65310,"NR34")},1280:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound2LengthAndDutyCycleRegister=t.sound1LengthAndDutyCycleRegister=t.LengthAndDutyCycleRegister=void 0;const i=r(8254);class e{constructor(n,d){this.offset=n,this.name=d}get value(){return i.memory.readByte(this.offset)}get waveformDutyCycle(){return this.value>>6}get soundLength(){return 63&this.value}}t.LengthAndDutyCycleRegister=e,t.sound1LengthAndDutyCycleRegister=new e(65297,"NR11"),t.sound2LengthAndDutyCycleRegister=new e(65302,"NR21")},1090:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3LowOrderFrequencyRegister=t.sound2LowOrderFrequencyRegister=t.sound1LowOrderFrequencyRegister=t.LowOrderFrequencyRegisters=void 0;const i=r(8254);class e{constructor(n,d){this.offset=n,this.name=d}get value(){return i.memory.readByte(this.offset)}}t.LowOrderFrequencyRegisters=e,t.sound1LowOrderFrequencyRegister=new e(65299,"NR13"),t.sound2LowOrderFrequencyRegister=new e(65304,"NR23"),t.sound3LowOrderFrequencyRegister=new e(65309,"NR33")},9229:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3LengthRegister=t.Sound3LengthRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65307,this.name="NR31"}get value(){return i.memory.readByte(this.offset)}}t.Sound3LengthRegister=e,t.sound3LengthRegister=new e},9564:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3OutputLevelRegister=t.Sound3OutputLevelRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65308,this.name="NR32"}get value(){return i.memory.readByte(this.offset)}get outputLevel(){return this.value>>5&3}}t.Sound3OutputLevelRegister=e,t.sound3OutputLevelRegister=new e},1436:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4ContinuousSelectionRegister=t.Sound4ContinuousSelectionRegister=void 0;const i=r(8254),e=r(5425);class s{constructor(){this.offset=65315,this.name="NR44"}get value(){return i.memory.readByte(this.offset)}get isInitialize(){return this.value>>7==1}set isInitialize(d){const c=e.setBit(this.value,7,d?1:0);i.memory.writeByte(this.offset,c)}get isContinuousSelection(){return(this.value>>6&1)==0}}t.Sound4ContinuousSelectionRegister=s,t.sound4ContinuousSelectionRegister=new s},5352:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4LengthRegister=t.Sound4LengthRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65312,this.name="NR41"}get value(){return i.memory.readByte(this.offset)}get soundLength(){return 63&this.value}}t.Sound4LengthRegister=e,t.sound4LengthRegister=new e},9999:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4PolynomialRegister=void 0;const i=r(8254);t.sound4PolynomialRegister=new class{constructor(){this.offset=65314,this.name="NR43",this.divisors=[8,16,32,48,64,80,96,112]}get value(){return i.memory.readByte(this.offset)}get clockShift(){return this.value>>4}get counterWidth(){return(this.value>>3&1)==1?7:15}get dividingRatio(){return 3&this.value}get divisor(){const e=7&this.value;return this.divisors[e]}get frequency(){const e=this.dividingRatio;return 524288/(e===0?.5:e)/Math.pow(2,this.clockShift+1)}}},6001:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.soundsOnRegister=void 0;const i=r(8254),e=r(5425);t.soundsOnRegister=new class{constructor(){this.offset=65318,this.name="NR52"}get value(){return i.memory.readByte(this.offset)}set value(s){i.memory.writeByte(this.offset,s)}get isAllSoundOn(){return(this.value>>7&1)==1}get isSound4On(){return(this.value>>3&1)==1}get isSound3On(){return(this.value>>2&1)==1}get isSound2On(){return(this.value>>1&1)==1}get isSound1On(){return(1&this.value)==1}set isSound1On(s){this.value=e.setBit(this.value,0,s?1:0)}set isSound2On(s){this.value=e.setBit(this.value,1,s?1:0)}set isSound3On(s){this.value=e.setBit(this.value,2,s?1:0)}set isSound4On(s){this.value=e.setBit(this.value,3,s?1:0)}}},5014:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sweepControlRegister=t.SweepControlRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65297,this.name="NR11"}get value(){return i.memory.readByte(this.offset)}get sweepTime(){return this.value>>4&7}get sweepTimeInSeconds(){return this.sweepTime/1280}get isSweepIncrease(){return(this.value>>3&1)==1}get sweepAmount(){return 7&this.value}}t.SweepControlRegister=e,t.sweepControlRegister=new e},3210:function(h,t,r){var i=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(t,"__esModule",{value:!0}),t.RingBufferPlayer=void 0;const e=r(2298),s=i(r(6509));t.RingBufferPlayer=class{constructor(n,d){this.sampleBufferIndex=0,this.sampleBuffer=new Float32Array(d),this.parameterRawStorage=new ArrayBuffer(5),this.parameterByteArray=new Uint8Array(this.parameterRawStorage),this.parameterDataView=new DataView(this.parameterRawStorage),n.audioWorklet.addModule(this.getModuleFile()).then(()=>{const c=e.RingBufferWriter.GetSharedArrayBufferForCapacity(n.sampleRate/20,Float32Array);this.audioRingBufferWriter=new e.RingBufferWriter(c,Float32Array);const u=e.RingBufferWriter.GetSharedArrayBufferForCapacity(32,Uint8Array);this.parameterRingBufferWriter=new e.RingBufferWriter(u,Uint8Array),this.ringBufferPlayerNode=new AudioWorkletNode(n,"ring-buffer-processor",{processorOptions:{audioQueue:c,paramQueue:u}}),this.ringBufferPlayerNode.connect(n.destination)})}writeSample(n){var d;this.sampleBuffer[this.sampleBufferIndex]=n,this.sampleBufferIndex++,this.sampleBufferIndex===this.sampleBuffer.length&&((d=this.audioRingBufferWriter)==null||d.push(this.sampleBuffer),this.sampleBufferIndex=0)}writeParameter(n,d){return this.parameterDataView.setUint8(0,n),this.parameterDataView.setFloat32(1,d),!(!this.parameterRingBufferWriter||this.parameterRingBufferWriter.availableWrite()<this.parameterRawStorage.byteLength)&&this.parameterRingBufferWriter&&this.parameterRingBufferWriter.push(this.parameterByteArray)===this.parameterRawStorage.byteLength}getModuleFile(){const n=s.default,d=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(d)}}},2298:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RingBufferWriter=void 0;class r{constructor(e,s){this.capacity=(e.byteLength-r.SizeOfPointers)/s.BYTES_PER_ELEMENT,this.sharedBuffer=e,this.writePointer=new Uint32Array(this.sharedBuffer,0,1),this.readPointer=new Uint32Array(this.sharedBuffer,4,1),this.storage=new s(this.sharedBuffer,8,this.capacity)}static GetSharedArrayBufferForCapacity(e,s){const n=(e+1)*s.BYTES_PER_ELEMENT+r.SizeOfPointers;return new SharedArrayBuffer(n)}push(e){const s=Atomics.load(this.readPointer,0),n=Atomics.load(this.writePointer,0),d=this._availableWrite(s,n);if(d===0)return console.log("full"),0;const c=Math.min(d,e.length),u=Math.min(this.capacity-n,c),f=c-u;this.copy(e,0,this.storage,n,u),this.copy(e,u,this.storage,0,f);const o=(n+c)%this.capacity;return Atomics.store(this.writePointer,0,o),c}availableWrite(){const e=Atomics.load(this.readPointer,0),s=Atomics.load(this.writePointer,0);return this._availableWrite(e,s)}_availableWrite(e,s){let n=e-s-1;return s>=e&&(n+=this.capacity),n}copy(e,s,n,d,c){for(let u=0;u<c;u++)n[d+u]=e[s+u]}}t.RingBufferWriter=r,r.WritePointerByteSize=4,r.ReadPointerByteSize=4,r.SizeOfPointers=r.WritePointerByteSize+r.ReadPointerByteSize},8107:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound1=void 0;const i=r(8254),e=r(7637),s=r(8343),n=r(5014),d=r(1280),c=r(9550),u=r(1090),f=r(6001);t.Sound1=class{constructor(){this.dutyCycles=[[0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1],[1,0,0,0,0,1,1,1],[0,1,1,1,1,1,1,0]],this.positionInDutyCycle=0,this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.enveloper=new e.Enveloper,this.volume=0,this.isSweepEnabled=!1,this.shadowFrequency=0,this.sweepTimer=0}tick(o){c.sound1HighOrderFrequencyRegister.isInitialize&&(this.playSound(),c.sound1HighOrderFrequencyRegister.isInitialize=!1),this.frequencyTimer-=o,this.frequencyTimer<=0&&(this.frequencyTimer+=this.frequencyPeriod,this.positionInDutyCycle=(this.positionInDutyCycle+1)%8)}playSound(){f.soundsOnRegister.isSound1On=!0,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.volume=s.sound1EnvelopeControlRegister.initialVolume,this.enveloper.initializeTimer(s.sound1EnvelopeControlRegister.lengthOfEnvelopeStep),this.lengthTimer=64-d.sound1LengthAndDutyCycleRegister.soundLength}clockLength(){c.sound1HighOrderFrequencyRegister.isContinuousSelection||(this.lengthTimer--,this.lengthTimer===0&&(f.soundsOnRegister.isSound1On=!1))}clockVolume(){this.volume=this.enveloper.clockVolume(this.volume,s.sound1EnvelopeControlRegister)}clockSweep(){if(this.sweepTimer>0&&this.sweepTimer--,this.sweepTimer===0&&(this.resetSweepTimer(),this.isSweepEnabled&&n.sweepControlRegister.sweepTime>0)){const o=this.calculateNewSweepFrequency();o<2048&&n.sweepControlRegister.sweepAmount>0&&(this.shadowFrequency=o,this.frequencyPeriod=4*(2048-o))}}resetSweepTimer(){this.sweepTimer=n.sweepControlRegister.sweepTime,this.sweepTimer===0&&(this.sweepTimer=8)}calculateNewSweepFrequency(){const{sweepAmount:o,isSweepIncrease:m}=n.sweepControlRegister,b=this.shadowFrequency>>o,T=m?-b:b,S=this.shadowFrequency+T;return S>=2048&&(f.soundsOnRegister.isSound1On=!1),S}getSample(){const o=this.dutyCycles[d.sound1LengthAndDutyCycleRegister.waveformDutyCycle][this.positionInDutyCycle];return f.soundsOnRegister.isSound1On?o*this.volume/15:0}getFrequencyPeriod(){return 4*(2048-(2047&i.memory.readWord(u.sound1LowOrderFrequencyRegister.offset)))}}},1710:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound2=void 0;const i=r(8254),e=r(7637),s=r(8343),n=r(9550),d=r(1280),c=r(1090),u=r(6001);t.Sound2=class{constructor(){this.dutyCycles=[[0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1],[1,0,0,0,0,1,1,1],[0,1,1,1,1,1,1,0]],this.positionInDutyCycle=0,this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.enveloper=new e.Enveloper,this.volume=0}tick(f){n.sound2HighOrderFrequencyRegister.isInitialize&&(this.playSound(),n.sound2HighOrderFrequencyRegister.isInitialize=!1),this.frequencyTimer-=f,this.frequencyTimer<=0&&(this.frequencyTimer+=this.frequencyPeriod,this.positionInDutyCycle=(this.positionInDutyCycle+1)%8)}playSound(){u.soundsOnRegister.isSound2On=!0,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.volume=s.sound2EnvelopeControlRegister.initialVolume,this.enveloper.initializeTimer(s.sound2EnvelopeControlRegister.lengthOfEnvelopeStep),this.lengthTimer=64-d.sound2LengthAndDutyCycleRegister.soundLength}clockLength(){n.sound2HighOrderFrequencyRegister.isContinuousSelection||(this.lengthTimer--,this.lengthTimer===0&&(u.soundsOnRegister.isSound2On=!1))}clockVolume(){this.volume=this.enveloper.clockVolume(this.volume,s.sound2EnvelopeControlRegister)}getSample(){const f=this.dutyCycles[d.sound2LengthAndDutyCycleRegister.waveformDutyCycle][this.positionInDutyCycle];return u.soundsOnRegister.isSound2On&&this.volume>0?f*this.volume/15:0}getFrequencyPeriod(){return 4*(2048-(2047&i.memory.readWord(c.sound2LowOrderFrequencyRegister.offset)))}}},3893:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound3=void 0;const i=r(8254),e=r(9550),s=r(9564),n=r(1090),d=r(6001),c=r(5425),u=r(9229);t.Sound3=class{constructor(){this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.waveTableMemoryAddress=65328,this.waveTablePosition=0,this.shifts=[4,0,1,2]}tick(f){e.sound3HighOrderFrequencyRegister.isInitialize&&(this.playSound(),e.sound3HighOrderFrequencyRegister.isInitialize=!1),this.frequencyTimer-=f,this.frequencyTimer<=0&&(this.frequencyTimer+=this.frequencyPeriod,this.waveTablePosition++,this.waveTablePosition===32&&(this.waveTablePosition=0))}playSound(){d.soundsOnRegister.isSound3On=!0,this.waveTablePosition=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.lengthTimer=256-u.sound3LengthRegister.value}clockLength(){e.sound3HighOrderFrequencyRegister.isContinuousSelection||(this.lengthTimer--,this.lengthTimer===0&&(d.soundsOnRegister.isSound3On=!1))}getSample(){const f=Math.floor(this.waveTablePosition/2),o=i.memory.readByte(this.waveTableMemoryAddress+f),m=(this.waveTablePosition%2==1?c.getLowerNibble(o):c.getUpperNibble(o))>>this.shifts[s.sound3OutputLevelRegister.outputLevel];return d.soundsOnRegister.isSound3On&&s.sound3OutputLevelRegister.outputLevel!==0?m/15:0}getFrequencyPeriod(){return 2*(2048-(2047&i.memory.readWord(n.sound3LowOrderFrequencyRegister.offset)))}}},6283:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound4=void 0;const i=r(7637),e=r(5425),s=r(9999),n=r(8343),d=r(1436),c=r(5352),u=r(6001);t.Sound4=class{constructor(){this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.enveloper=new i.Enveloper,this.volume=0,this.linearFeedbackShift=0}tick(f){d.sound4ContinuousSelectionRegister.isInitialize&&(this.playSound(),d.sound4ContinuousSelectionRegister.isInitialize=!1),this.frequencyTimer-=f,this.frequencyTimer<=0&&(this.frequencyTimer=this.getFrequencyPeriod(),this.stepLinearFeedbackShift())}getFrequencyPeriod(){return s.sound4PolynomialRegister.divisor<<s.sound4PolynomialRegister.clockShift}playSound(){u.soundsOnRegister.isSound4On=!0,this.linearFeedbackShift=32767,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.volume=n.sound4EnvelopeControlRegister.initialVolume,this.enveloper.initializeTimer(n.sound4EnvelopeControlRegister.lengthOfEnvelopeStep),this.lengthTimer=64-c.sound4LengthRegister.soundLength}clockLength(){d.sound4ContinuousSelectionRegister.isContinuousSelection||(this.lengthTimer--,this.lengthTimer===0&&(u.soundsOnRegister.isSound4On=!1))}clockVolume(){this.volume=this.enveloper.clockVolume(this.volume,n.sound4EnvelopeControlRegister)}stepLinearFeedbackShift(){const f=e.getBit(this.linearFeedbackShift,0),o=e.getBit(this.linearFeedbackShift,1)^f;this.linearFeedbackShift>>=1,this.linearFeedbackShift=e.setBit(this.linearFeedbackShift,14,o),s.sound4PolynomialRegister.counterWidth===7&&(this.linearFeedbackShift=e.setBit(this.linearFeedbackShift,6,o))}getSample(){const f=1&~this.linearFeedbackShift;return u.soundsOnRegister.isSound4On&&this.volume>0?f*this.volume/15:0}}},7189:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CartridgeLoader=void 0;const i=r(3426),e=r(9268),s=r(9259),n=r(1992);class d{static FromArrayBuffer(u){const f=new DataView(u);switch(f.getUint8(d.TypeOffset)){case i.CartridgeType.ROM:return new s.Cartridge(f);case i.CartridgeType.MBC1:case i.CartridgeType.MBC1_RAM:case i.CartridgeType.MBC1_RAM_BATTERY:return new e.Mbc1Cartridge(f);case i.CartridgeType.MBC3:case i.CartridgeType.MBC3_RAM:case i.CartridgeType.MBC3_RAM_BATTERY:case i.CartridgeType.MBC3_TIMER_BATTERY:case i.CartridgeType.MBC3_TIMER_RAM_BATTERY:return new n.Mbc3Cartridge(f);default:return alert("oops not ready"),new s.Cartridge(f)}}}t.CartridgeLoader=d,d.TypeOffset=327},3426:(h,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.CartridgeType=void 0,(r=t.CartridgeType||(t.CartridgeType={}))[r.ROM=0]="ROM",r[r.MBC1=1]="MBC1",r[r.MBC1_RAM=2]="MBC1_RAM",r[r.MBC1_RAM_BATTERY=3]="MBC1_RAM_BATTERY",r[r.MBC2=5]="MBC2",r[r.MBC2_BATTERY=6]="MBC2_BATTERY",r[r.ROM_RAM=8]="ROM_RAM",r[r.ROM_RAM_BATTERY=9]="ROM_RAM_BATTERY",r[r.MMM01=11]="MMM01",r[r.MMM01_RAM=12]="MMM01_RAM",r[r.MMM01_RAM_BATTERY=13]="MMM01_RAM_BATTERY",r[r.MBC3_TIMER_BATTERY=15]="MBC3_TIMER_BATTERY",r[r.MBC3_TIMER_RAM_BATTERY=16]="MBC3_TIMER_RAM_BATTERY",r[r.MBC3=17]="MBC3",r[r.MBC3_RAM=18]="MBC3_RAM",r[r.MBC3_RAM_BATTERY=19]="MBC3_RAM_BATTERY",r[r.MBC5=25]="MBC5",r[r.MBC5_RAM=26]="MBC5_RAM",r[r.MBC5_RAM_BATTERY=27]="MBC5_RAM_BATTERY",r[r.MBC5_RUMBLE=28]="MBC5_RUMBLE",r[r.MBC5_RUMBLE_RAM=29]="MBC5_RUMBLE_RAM",r[r.MBC5_RUMBLE_RAM_BATTERY=30]="MBC5_RUMBLE_RAM_BATTERY",r[r.MBC6=32]="MBC6",r[r.MBC7_SENSOR_RUMBLE_RAM_BATTERY=34]="MBC7_SENSOR_RUMBLE_RAM_BATTERY",r[r.POCKET_CAMERA=252]="POCKET_CAMERA",r[r.BANDAI_TAMA5=253]="BANDAI_TAMA5",r[r.HuC3=254]="HuC3",r[r.HuC1_RAM_BATTERY=255]="HuC1_RAM_BATTERY"},9259:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Cartridge=void 0;const i=r(3426);class e{constructor(n){this.gameDataView=n,this.gameBytes=new Uint8Array(n.buffer)}readByte(n){return this.gameDataView.getUint8(n)}readSignedByte(n){return this.gameDataView.getInt8(n)}readWord(n){return this.gameDataView.getUint16(n,!0)}writeByte(n,d){}writeWord(n,d){}get title(){const n=new TextDecoder,d=this.gameBytes.subarray(308,323);return n.decode(d)}get typeName(){const n=this.gameDataView.getUint8(327);return i.CartridgeType[n]}get type(){return this.gameDataView.getUint8(327)}get romSize(){return[32768,65536,131072,262144,524288,1048576,2097152,4096,8192][this.gameDataView.getUint8(328)]}get ramSize(){return[0,8192,32768,204800,1212416,5316608][this.gameDataView.getUint8(329)]}get versionNumber(){return this.gameDataView.getUint8(332)}get hasSaveableRam(){return e.TypesWithBatterySave.includes(this.type)}}t.Cartridge=e,e.EntryPointOffset=256,e.TypesWithBatterySave=[i.CartridgeType.ROM_RAM_BATTERY,i.CartridgeType.MBC1_RAM_BATTERY,i.CartridgeType.MBC2_BATTERY,i.CartridgeType.MBC3_RAM_BATTERY]},9268:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mbc1Cartridge=void 0;const i=r(9259),e=r(3426);var s,n;(function(c){c[c.RamGateRegister=0]="RamGateRegister",c[c.Bank1Register=1]="Bank1Register",c[c.Bank2Register=2]="Bank2Register",c[c.ModeRegister=3]="ModeRegister",c[c.Sram=4]="Sram"})(s||(s={})),function(c){c[c.RomBankZero=0]="RomBankZero",c[c.RomBankZeroMode1=1]="RomBankZeroMode1",c[c.RomBank=2]="RomBank",c[c.Sram=3]="Sram",c[c.Invalid=4]="Invalid"}(n||(n={}));class d extends i.Cartridge{constructor(u){super(u),this.isRamEnabled=!1,this.bank1=1,this.bank2=0,this.mode=0,this.ramData=new ArrayBuffer(this.ramSize),this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer),this.ramBytes.fill(255)}setRam(u){this.ramData=u,this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer)}dumpRam(){return this.ramDataView.buffer}writeByte(u,f){this.write(u,f,(o,m)=>{this.ramDataView.setUint8(o,m),this.type===e.CartridgeType.MBC1_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout(()=>this.onSramWrite(this.ramData),500))})}writeWord(u,f){this.write(u,f,(o,m)=>{this.ramDataView.setUint16(o,m,!0),this.type===e.CartridgeType.MBC1_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout(()=>this.onSramWrite(this.ramData),500))})}readByte(u){return this.read(u,f=>this.gameDataView.getUint8(f),f=>this.ramDataView.getUint8(f))}readSignedByte(u){return this.read(u,f=>this.gameDataView.getInt8(f),f=>this.ramDataView.getInt8(f))}readWord(u){return this.read(u,f=>this.gameDataView.getUint16(f,!0),f=>this.ramDataView.getUint16(f,!0))}read(u,f,o){const m=16383&u;if(u>=0&&u<=16383)return this.mode===0?f(m):f((this.bank2<<5<<14)+m&this.romSize-1);if(u>=16384&&u<=32767)return f(((this.bank2<<5)+this.bank1<<14)+m&this.romSize-1);{if(!this.isRamEnabled)return 255;const b=8191&u;return this.mode===0||this.ramSize===32768?o(b):o((this.bank2<<13)+b)}}write(u,f,o){if(this.isRamGate(u)){const b=15&f;this.isRamEnabled=b===10}else if(this.isBank1(u)){const m=31&f;this.bank1=m===0?1:m}else if(this.isBank2(u))this.bank2=3&f;else if(this.isMode(u))this.mode=1&f;else if(this.isRam(u)&&this.isRamEnabled){const m=8191&u;this.mode===0||this.ramSize===32768?o(m,f):o((this.bank2<<13)+m,f)}}isRamGate(u){return u>=0&&u<=8191}isBank1(u){return u>=8192&&u<=16383}isBank2(u){return u>=16384&&u<=24575}isMode(u){return u>=24576&&u<=32767}isRam(u){return u>=40960&&u<=49151}}t.Mbc1Cartridge=d},1992:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mbc3Cartridge=void 0;const i=r(9259),e=r(3426);class s extends i.Cartridge{constructor(d){super(d),this.romBank=0,this.isRamAndRtcEnabled=!1,this.ramBankOrRtcSelection=0,this.ramData=new ArrayBuffer(this.ramSize),this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer),this.ramBytes.fill(255)}setRam(d){this.ramData=d,this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer)}dumpRam(){return this.ramDataView.buffer}writeByte(d,c){this.write(d,c,(u,f)=>{this.ramDataView.setUint8(u,f),this.type===e.CartridgeType.MBC3_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout(()=>this.onSramWrite(this.ramData),500))})}writeWord(d,c){this.write(d,c,(u,f)=>{this.ramDataView.setUint16(u,f,!0),this.type===e.CartridgeType.MBC3_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout(()=>this.onSramWrite(this.ramData),500))})}readByte(d){return this.read(d,c=>this.gameDataView.getUint8(c),c=>this.ramDataView.getUint8(c))}readSignedByte(d){return this.read(d,c=>this.gameDataView.getInt8(c),c=>this.ramDataView.getInt8(c))}readWord(d){return this.read(d,c=>this.gameDataView.getUint16(c,!0),c=>this.ramDataView.getUint16(c,!0))}read(d,c,u){const f=16383&d;if(d>=0&&d<=16383)return c(d);if(d>=16384&&d<=32767)return c((this.romBank<<14)+f&this.romSize-1);if(!this.isRamAndRtcEnabled)return 255;if(this.ramBankOrRtcSelection<=3){const o=8191&d;return u((this.ramBankOrRtcSelection<<13)+o)}}write(d,c,u){if(this.isRamAndTimerGate(d)){const o=15&c;this.isRamAndRtcEnabled=o===10}else if(this.isRomBank(d)){const f=127&c;this.romBank=f===0?1:f}else if(this.isRamBankNumberOrRtcRegisterSelect(d))this.ramBankOrRtcSelection=c;else if(this.isLatchClockData(d))console.log("not implemented");else if(this.isRamBankOrRtcRegister(d)){const f=8191&d;this.ramBankOrRtcSelection<=3&&u((this.ramBankOrRtcSelection<<13)+f,c)}}isRamAndTimerGate(d){return d>=0&&d<=8191}isRomBank(d){return d>=8192&&d<=16383}isRamBankNumberOrRtcRegisterSelect(d){return d>=16384&&d<=24575}isLatchClockData(d){return d>=24576&&d<=32767}isRamBankOrRtcRegister(d){return d>=40960&&d<=49151}}t.Mbc3Cartridge=s},9145:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CPU=void 0;const i=r(2710),e=r(8254),s=r(7294),n=r(5494),d=r(1456),c=r(9879),u=r(927),f=r(8543),o=r(9099),m=r(9259),b=r(5449),T=r(7300),S=r(3739),_=r(9904),D=r(5425),I=r(9080),C=r(6584),N=r(4002),w=r(3120);class B{constructor(){this.isInterruptMasterEnable=!0,this.operationMap=new Map,this.cbSubOperationMap=new Map,this.createInputOutputOperations=_.createInputOutputOperations,this.createArithmeticOperations=S.createArithmeticOperations,this.createLogicalOperations=T.createLogicalOperations,this.createRotateShiftOperations=c.createRotateShiftOperations,this.createJumpOperations=d.createJumpOperations,this.createGeneralPurposeOperations=u.createGeneralPurposeOperations,this.createCallAndReturnOperations=s.createCallAndReturnOperations,this.createInterruptOperations=n.createInterruptOperations,this.createCbSubOperations=b.createCbSubOperations,this.timerCycles=0,this.frequencyCounter=0,this.cycleMultiplier=4,this.isHalted=!1,this.isStopped=!1,this.registers=new i.CpuRegisterCollection,this.createInputOutputOperations(),this.createArithmeticOperations(),this.createLogicalOperations(),this.createRotateShiftOperations(),this.createJumpOperations(),this.createGeneralPurposeOperations(),this.createCallAndReturnOperations(),this.createInterruptOperations(),this.createCbSubOperations(),this.initialize()}initialize(){this.registers.programCounter.value=m.Cartridge.EntryPointOffset,this.registers.stackPointer.value=65534,this.registers.HL.value=333,this.registers.C.value=19,this.registers.E.value=216,this.registers.A.value=1,this.registers.F.value=176}tick(){if(this.handleInterrupts(),this.isHalted)return this.updateTimers(1),1;const R=this.getOperation();return R.execute(),this.updateTimers(R.cycleTime),R.cycleTime}reset(){this.registers.reset()}halt(){this.isHalted=!0}stop(){this.isStopped=!0}pushToStack(R){this.registers.stackPointer.value-=2,e.memory.writeWord(this.registers.stackPointer.value,R)}popFromStack(){const R=e.memory.readWord(this.registers.stackPointer.value);return this.registers.stackPointer.value+=2,R}getOperation(){const R=e.memory.readByte(this.registers.programCounter.value);this.registers.programCounter.value++;const P=this.operationMap.get(R);if(!P){const M=R.toString(16),k=this.registers.programCounter.value.toString(16);throw new Error(`Operation ${M} at location ${k} not found.`)}return P}handleInterrupts(){const R=f.interruptRequestRegister.value&o.interruptEnableRegister.value;if(R>0&&(this.isHalted=!1),!this.isInterruptMasterEnable||R===0)return;this.pushToStack(this.registers.programCounter.value);const P=f.interruptRequestRegister.getInterruptFlags(R);P.isVerticalBlanking?(f.interruptRequestRegister.clearVBlankInterruptRequest(),this.registers.programCounter.value=B.VBlankInterruptAddress):P.isLCDStatus?(f.interruptRequestRegister.clearLcdStatusInterruptRequest(),this.registers.programCounter.value=B.LCDStatusInterruptAddress):P.isTimerOverflow?(f.interruptRequestRegister.clearTimerOverflowInterruptRequest(),this.registers.programCounter.value=B.TimerOverflowInterruptAddress):P.isSerialTransferCompletion?(f.interruptRequestRegister.clearSerialTransferInterruptRequest(),this.registers.programCounter.value=B.SerialTransferCompletionInterruptAddress):P.isP10P13NegativeEdge&&(f.interruptRequestRegister.clearP10P13NegativeEdgeInterruptRequest(),this.registers.programCounter.value=B.P10P13InputSignalLowInterruptAddress),this.isInterruptMasterEnable=!1}updateTimers(R){this.frequencyCounter=D.asUint16(this.frequencyCounter+R*this.cycleMultiplier),I.dividerRegister.setValueFromCpuDivider(D.getMostSignificantByte(this.frequencyCounter)),C.timerControllerRegister.isTimerOn&&(this.timerCycles+=R,this.timerCycles>=C.timerControllerRegister.cyclesForTimerUpdate&&(N.timerCounterRegister.value+1>255&&(f.interruptRequestRegister.triggerTimerInterruptRequest(),N.timerCounterRegister.value=w.timerModuloRegister.value),N.timerCounterRegister.value++,this.timerCycles=0))}addOperation(R){if(this.operationMap.has(R.byteDefinition))throw new Error(`Operation ${R.byteDefinition.toString(2)} has already been defined`);this.operationMap.set(R.byteDefinition,R)}addCbOperation(R){if(this.cbSubOperationMap.has(R.byteDefinition))throw new Error(`Operation ${R.byteDefinition.toString(2)} has already been defined`);this.cbSubOperationMap.set(R.byteDefinition,R)}}t.CPU=B,B.OperatingHertz=4194304,B.VBlankInterruptAddress=64,B.LCDStatusInterruptAddress=72,B.TimerOverflowInterruptAddress=80,B.SerialTransferCompletionInterruptAddress=88,B.P10P13InputSignalLowInterruptAddress=96},8025:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuFlagRegisterPair=void 0;const i=r(3115);class e extends i.CpuRegister{get value(){return this.dataView.getUint16(this.offset,!0)}set value(n){this.dataView.setUint16(this.offset,65520&n,!0)}}t.CpuFlagRegisterPair=e},9754:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuFlagRegister=void 0;const i=r(3115);class e extends i.CpuRegister{get Z(){return this.value>>7}set Z(n){n===1?this.value|=128:this.value&=-129}get isResultZero(){return this.Z===1}set isResultZero(n){this.Z=n?1:0}get N(){return this.value>>6&1}set N(n){n===1?this.value|=64:this.value&=-65}get isSubtraction(){return this.N===1}set isSubtraction(n){this.N=n?1:0}get H(){return this.value>>5&1}set H(n){n===1?this.value|=32:this.value&=-33}get isHalfCarry(){return this.H===1}set isHalfCarry(n){this.H=n?1:0}get CY(){return this.value>>4&1}set CY(n){n===1?this.value|=16:this.value&=-17}get isCarry(){return this.CY===1}set isCarry(n){this.CY=n?1:0}}t.CpuFlagRegister=e},2710:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuRegisterCollection=void 0;const i=r(3115),e=r(9754),s=r(8025);t.CpuRegisterCollection=class{constructor(){this.registersBuffer=new ArrayBuffer(12),this.registersView=new DataView(this.registersBuffer),this.F=new e.CpuFlagRegister("F",0,this.registersBuffer,-1),this.A=new i.CpuRegister("A",1,this.registersBuffer,i.CpuRegister.Code.A),this.C=new i.CpuRegister("C",2,this.registersBuffer,i.CpuRegister.Code.C),this.B=new i.CpuRegister("B",3,this.registersBuffer,i.CpuRegister.Code.B),this.E=new i.CpuRegister("E",4,this.registersBuffer,i.CpuRegister.Code.E),this.D=new i.CpuRegister("D",5,this.registersBuffer,i.CpuRegister.Code.D),this.L=new i.CpuRegister("L",6,this.registersBuffer,i.CpuRegister.Code.L),this.H=new i.CpuRegister("H",7,this.registersBuffer,i.CpuRegister.Code.H),this.AF=new s.CpuFlagRegisterPair("AF",0,this.registersBuffer,i.CpuRegister.PairCode.AF,2),this.BC=new i.CpuRegister("BC",2,this.registersBuffer,i.CpuRegister.PairCode.BC,2),this.DE=new i.CpuRegister("DE",4,this.registersBuffer,i.CpuRegister.PairCode.DE,2),this.HL=new i.CpuRegister("HL",6,this.registersBuffer,i.CpuRegister.PairCode.HL,2),this.programCounter=new i.CpuRegister("PC",8,this.registersBuffer,-1,2),this.stackPointer=new i.CpuRegister("SP",10,this.registersBuffer,i.CpuRegister.PairCode.SP,2),this.baseRegisters=[this.A,this.B,this.C,this.D,this.E,this.H,this.L],this.registerPairs=[this.AF,this.BC,this.DE,this.HL,this.stackPointer]}get flags(){return this.F}reset(){this.registersBuffer=new ArrayBuffer(12),this.registersView=new DataView(this.registersBuffer)}}},3115:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuRegister=void 0;class r{constructor(e,s,n,d,c=1){this.name=e,this.offset=s,this.dataView=new DataView(n),this.code=d,this.byteSize=c}get value(){return this.byteSize===1?this.dataView.getUint8(this.offset):this.dataView.getUint16(this.offset,!0)}set value(e){this.byteSize===1?this.dataView.setUint8(this.offset,e):this.dataView.setUint16(this.offset,e,!0)}}t.CpuRegister=r,function(i){(function(e){e[e.A=7]="A",e[e.B=0]="B",e[e.C=1]="C",e[e.D=2]="D",e[e.E=3]="E",e[e.H=4]="H",e[e.L=5]="L"})(i.Code||(i.Code={})),function(e){e[e.BC=0]="BC",e[e.DE=1]="DE",e[e.HL=2]="HL",e[e.AF=3]="AF",e[e.SP=3]="SP"}(i.PairCode||(i.PairCode={}))}(r=t.CpuRegister||(t.CpuRegister={}))},4114:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBitSubOperations=void 0;const i=r(5425),e=r(8254);t.getBitSubOperations=function(s){const{registers:n}=s;function d(f,o){const m=i.getBit(f,o);n.flags.isResultZero=!m,n.flags.isHalfCarry=!0,n.flags.isSubtraction=!1}function c(f,o){return 64+(f<<3)+o}function u(f){return 64+(f<<3)+6}s.registers.baseRegisters.forEach(f=>{for(let o=0;o<8;o++)s.addCbOperation({byteDefinition:c(o,f.code),instruction:`BIT ${o}, ${f.name}`,cycleTime:2,byteLength:2,execute(){d(f.value,o)}})});for(let f=0;f<8;f++)s.addCbOperation({byteDefinition:u(f),instruction:`BIT ${f}, (HL)`,cycleTime:3,byteLength:2,execute(){d(e.memory.readByte(n.HL.value),f)}})}},5449:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCbSubOperations=void 0;const i=r(9801),e=r(4114),s=r(6782),n=r(2238),d=r(8254);t.createCbSubOperations=function(){const c=this;this.addOperation({instruction:"",byteDefinition:203,cycleTime:0,byteLength:0,execute(){const u=d.memory.readByte(c.registers.programCounter.value);c.registers.programCounter.value++,c.cbSubOperationMap.get(u).execute()}}),i.getRotateShiftSubOperations(c),e.getBitSubOperations(c),s.getSetSubOperations(c),n.getResSubOperations(c)}},2238:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getResSubOperations=void 0;const i=r(5425),e=r(8254);t.getResSubOperations=function(s){const{registers:n}=s;function d(u,f){return 128+(u<<3)+f}function c(u){return 128+(u<<3)+6}s.registers.baseRegisters.forEach(u=>{for(let f=0;f<8;f++)s.addCbOperation({byteDefinition:d(f,u.code),instruction:`RES ${f}, ${u.name}`,cycleTime:2,byteLength:2,execute(){u.value=i.clearBit(u.value,f)}})});for(let u=0;u<8;u++)s.addCbOperation({byteDefinition:c(u),instruction:`RES ${u}, (HL)`,cycleTime:3,byteLength:2,execute(){const f=e.memory.readByte(n.HL.value),o=i.clearBit(f,u);e.memory.writeByte(n.HL.value,o)}})}},9801:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRotateShiftSubOperations=void 0;const i=r(8254),e=r(5425);t.getRotateShiftSubOperations=function(s){const{registers:n}=s;function d(c){const u=((15&c)<<4)+(c>>4);return n.flags.isResultZero=u===0,n.flags.isSubtraction=!1,n.flags.isHalfCarry=!1,n.flags.isCarry=!1,u}s.registers.baseRegisters.forEach(c=>{var u;s.addCbOperation({byteDefinition:(u=c.code,48+u),instruction:`SWAP ${c.name}`,cycleTime:2,byteLength:2,execute(){c.value=d(c.value)}})}),s.addCbOperation({byteDefinition:54,instruction:"SWAP (HL)",cycleTime:4,byteLength:2,execute(){const c=i.memory.readByte(n.HL.value);i.memory.writeByte(n.HL.value,d(c))}}),n.baseRegisters.forEach(c=>{var u;s.addCbOperation({byteDefinition:(u=c.code,0+u),instruction:`RLC ${c.name}`,cycleTime:2,byteLength:2,execute(){const f=c.value>>7;c.value=(c.value<<1)+f,n.flags.CY=f,n.flags.isHalfCarry=!1,n.flags.isResultZero=c.value===0,n.flags.isSubtraction=!1}})}),s.addCbOperation({byteDefinition:6,instruction:"RLC (HL)",cycleTime:4,byteLength:2,execute(){const c=i.memory.readByte(n.HL.value),u=c>>7,f=255&(c<<1&255)+u;i.memory.writeByte(n.HL.value,f),n.flags.CY=u,n.flags.isHalfCarry=!1,n.flags.isResultZero=f===0,n.flags.isSubtraction=!1}}),n.baseRegisters.forEach(c=>{var u;s.addCbOperation({instruction:`RL ${c.name}`,byteDefinition:(u=c.code,16+u),cycleTime:2,byteLength:2,execute(){const f=c.value>>7,o=255&(c.value<<1&255)+n.flags.CY;n.flags.CY=f,n.flags.isResultZero=o===0,n.flags.H=0,n.flags.N=0,c.value=o}})}),s.addCbOperation({instruction:"RL (HL)",byteDefinition:22,cycleTime:4,byteLength:2,execute(){const c=i.memory.readByte(n.HL.value),u=c>>7,f=255&(c<<1&255)+n.flags.CY;n.flags.CY=u,n.flags.H=0,n.flags.N=0,n.flags.isResultZero=f===0,i.memory.writeByte(n.HL.value,f)}}),n.baseRegisters.forEach(c=>{var u;s.addCbOperation({instruction:`RRC ${c.name}`,byteDefinition:(u=c.code,8+u),cycleTime:2,byteLength:2,execute(){const f=1&c.value,o=(c.value>>1&255)+(f<<7);n.flags.CY=f,n.flags.H=0,n.flags.isResultZero=o===0,n.flags.N=0,c.value=o}})}),s.addCbOperation({instruction:"RRC (HL)",byteDefinition:14,cycleTime:4,byteLength:2,execute(){const c=i.memory.readByte(n.HL.value),u=1&c,f=(c>>1&255)+(u<<7);n.flags.CY=u,n.flags.H=0,n.flags.isResultZero=f===0,n.flags.N=0,i.memory.writeByte(n.HL.value,f)}}),n.baseRegisters.forEach(c=>{var u;s.addCbOperation({instruction:`RR ${c.name}`,byteDefinition:(u=c.code,24+u),cycleTime:2,byteLength:2,execute(){const f=1&c.value,o=(c.value>>1&255)+(n.flags.CY<<7);n.flags.isResultZero=o===0,n.flags.CY=f,n.flags.H=0,n.flags.N=0,c.value=o}})}),s.addCbOperation({instruction:"RR (HL)",byteDefinition:30,cycleTime:4,byteLength:2,execute(){const c=i.memory.readByte(n.HL.value),u=1&c,f=(c>>1&255)+(n.flags.CY<<7);n.flags.isResultZero=f===0,n.flags.CY=u,n.flags.H=0,n.flags.N=0,i.memory.writeByte(n.HL.value,f)}}),n.baseRegisters.forEach(c=>{var u;s.addCbOperation({instruction:`SLA ${c.name}`,byteDefinition:(u=c.code,32+u),cycleTime:2,byteLength:2,execute(){const f=c.value>>7,o=c.value<<1&255;n.flags.isResultZero=o===0,n.flags.CY=f,n.flags.H=0,n.flags.N=0,c.value=o}})}),s.addCbOperation({instruction:"SLA (HL)",byteDefinition:38,cycleTime:4,byteLength:2,execute(){const c=i.memory.readByte(n.HL.value),u=c>>7,f=c<<1&255;n.flags.isResultZero=f===0,n.flags.CY=u,n.flags.H=0,n.flags.N=0,i.memory.writeByte(n.HL.value,f)}}),n.baseRegisters.forEach(c=>{var u;s.addCbOperation({instruction:`SRA ${c.name}`,byteDefinition:(u=c.code,40+u),cycleTime:2,byteLength:2,execute(){const f=1&c.value,o=c.value>>7,m=c.value>>1&255,b=e.setBit(m,7,o);n.flags.isResultZero=b===0,n.flags.CY=f,n.flags.H=0,n.flags.N=0,c.value=b}})}),s.addCbOperation({instruction:"SRA (HL)",byteDefinition:46,cycleTime:4,byteLength:2,execute(){const c=i.memory.readByte(n.HL.value),u=1&c,f=c>>7,o=c>>1&255,m=e.setBit(o,7,f);n.flags.isResultZero=m===0,n.flags.CY=u,n.flags.H=0,n.flags.N=0,i.memory.writeByte(n.HL.value,m)}}),n.baseRegisters.forEach(c=>{var u;s.addCbOperation({instruction:`SRL ${c.name}`,byteDefinition:(u=c.code,56+u),cycleTime:2,byteLength:2,execute(){const f=1&c.value,o=c.value>>1&255;n.flags.isResultZero=o===0,n.flags.CY=f,n.flags.H=0,n.flags.N=0,c.value=o}})}),s.addCbOperation({instruction:"SRL (HL)",byteDefinition:62,cycleTime:4,byteLength:2,execute(){const c=i.memory.readByte(n.HL.value),u=1&c,f=c>>1&255;n.flags.isResultZero=f===0,n.flags.CY=u,n.flags.H=0,n.flags.N=0,i.memory.writeByte(n.HL.value,f)}})}},6782:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSetSubOperations=void 0;const i=r(5425),e=r(8254);t.getSetSubOperations=function(s){const{registers:n}=s;function d(u,f){return 192+(u<<3)+f}function c(u){return 192+(u<<3)+6}s.registers.baseRegisters.forEach(u=>{for(let f=0;f<8;f++)s.addCbOperation({byteDefinition:d(f,u.code),instruction:`SET ${f}, ${u.name}`,cycleTime:2,byteLength:2,execute(){u.value=i.setBit(u.value,f,1)}})});for(let u=0;u<8;u++)s.addCbOperation({byteDefinition:c(u),instruction:`SET ${u}, (HL)`,cycleTime:3,byteLength:2,execute(){const f=e.memory.readByte(n.HL.value),o=i.setBit(f,u,1);e.memory.writeByte(n.HL.value,o)}})}},3739:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createArithmeticOperations=void 0;const i=r(8254);t.createArithmeticOperations=function(){const{registers:e}=this;function s(o,m){const b=o+m&255;return e.flags.isResultZero=b===0,e.flags.isHalfCarry=(15&b)<(15&o),e.flags.isSubtraction=!1,e.flags.isCarry=b<o,b}function n(o,m,b){const T=o+m+b&255;return e.flags.isResultZero=T===0,e.flags.isHalfCarry=(15&o)+(15&m)+b>15,e.flags.isSubtraction=!1,e.flags.isCarry=T<o+b,T}function d(o){const m=o-1&255;return e.flags.isResultZero=m===0,e.flags.isHalfCarry=(15&m)>(15&o),e.flags.isSubtraction=!0,m}function c(o){const m=o+1&255;return e.flags.isHalfCarry=(15&m)<(15&o),e.flags.isSubtraction=!1,e.flags.isResultZero=m===0,m}function u(o,m){const b=o-m&255;return e.flags.isResultZero=b===0,e.flags.isSubtraction=!0,e.flags.isHalfCarry=(15&b)>(15&o),e.flags.isCarry=b>o,b}function f(o,m,b){const T=o-m-b&255;return e.flags.isResultZero=T===0,e.flags.isHalfCarry=(15&o)-(15&m)-b<0,e.flags.isSubtraction=!0,e.flags.isCarry=T>o-b,T}this.registers.baseRegisters.forEach(o=>{var m;this.addOperation({byteDefinition:(m=o.code,128+m),cycleTime:1,byteLength:1,get instruction(){return`ADD A, ${o.name}`},execute(){e.A.value=s(e.A.value,o.value)}})}),this.addOperation({byteDefinition:198,cycleTime:2,byteLength:2,get instruction(){return`ADD A, 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const o=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=s(e.A.value,o)}}),this.addOperation({byteDefinition:134,cycleTime:2,byteLength:1,instruction:"ADD A, (HL)",execute(){const o=i.memory.readByte(e.HL.value);e.A.value=s(e.A.value,o)}}),this.registers.baseRegisters.forEach(o=>{var m;this.addOperation({byteDefinition:(m=o.code,136+m),instruction:`ADC A, ${o.name}`,cycleTime:1,byteLength:1,execute(){e.A.value=n(e.A.value,o.value,255&e.flags.CY)}})}),this.addOperation({byteDefinition:206,cycleTime:2,byteLength:2,get instruction(){return`ADC A, 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const o=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=n(e.A.value,o,e.flags.CY)}}),this.addOperation({byteDefinition:142,cycleTime:2,byteLength:1,instruction:"ADC A, (HL)",execute(){const o=i.memory.readByte(e.HL.value);e.A.value=n(e.A.value,o,e.flags.CY)}}),e.registerPairs.filter(o=>o.name!=="AF").forEach(o=>{var m;this.addOperation({instruction:`ADD HL, ${o.name}`,byteDefinition:(m=o.code,9+(m<<4)),cycleTime:2,byteLength:1,execute(){e.HL.value=function(b,T){const S=b+T&65535;return e.flags.isHalfCarry=(4095&S)<(4095&b),e.flags.isSubtraction=!1,e.flags.isCarry=S<b,S}(e.HL.value,o.value)}})}),this.addOperation({byteDefinition:232,cycleTime:4,byteLength:2,get instruction(){const o=i.memory.readSignedByte(e.programCounter.value);return o>=0?`ADD SP, 0x${o.toString(16)}`:`ADD SP, -0x${(-1*o).toString(16)}`},execute(){const o=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++;const m=15-(15&e.stackPointer.value),b=255-(255&e.stackPointer.value);e.flags.isHalfCarry=(15&o)>m,e.flags.isCarry=(255&o)>b,e.flags.isResultZero=!1,e.flags.isSubtraction=!1,e.stackPointer.value=e.stackPointer.value+o}}),this.registers.baseRegisters.forEach(o=>{var m;this.addOperation({instruction:`DEC ${o.name}`,byteDefinition:(m=o.code,5+(m<<3)),cycleTime:1,byteLength:1,execute(){o.value=d(o.value)}})}),this.addOperation({instruction:"DEC (HL)",byteDefinition:53,cycleTime:3,byteLength:1,execute(){const o=d(i.memory.readByte(e.HL.value));i.memory.writeByte(e.HL.value,o)}}),e.registerPairs.filter(o=>o.name!=="AF").forEach(o=>{var m;this.addOperation({instruction:`DEC ${o.name}`,byteDefinition:(m=o.code,11+(m<<4)),cycleTime:2,byteLength:1,execute(){o.value--}})}),this.registers.baseRegisters.forEach(o=>{var m;this.addOperation({byteDefinition:(m=o.code,4+(m<<3)),cycleTime:1,byteLength:1,instruction:`INC ${o.name}`,execute(){o.value=c(o.value)}})}),this.addOperation({byteDefinition:52,cycleTime:3,byteLength:1,instruction:"INC (HL)",execute(){const o=c(i.memory.readByte(e.HL.value));i.memory.writeByte(e.HL.value,o)}}),e.registerPairs.filter(o=>o.name!=="AF").forEach(o=>{var m;this.addOperation({byteDefinition:(m=o.code,3+(m<<4)),cycleTime:2,byteLength:1,instruction:`INC ${o.name}`,execute(){o.value++}})}),this.registers.baseRegisters.forEach(o=>{var m;this.addOperation({byteDefinition:(m=o.code,144+m),cycleTime:1,byteLength:1,instruction:`SUB ${o.name}`,execute(){e.A.value=u(e.A.value,o.value)}})}),this.addOperation({byteDefinition:214,cycleTime:2,byteLength:2,get instruction(){return`SUB 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const o=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=u(e.A.value,o)}}),this.addOperation({byteDefinition:150,cycleTime:2,byteLength:1,instruction:"SUB (HL)",execute(){const o=i.memory.readByte(e.HL.value);e.A.value=u(e.A.value,o)}}),this.registers.baseRegisters.forEach(o=>{var m;this.addOperation({byteDefinition:(m=o.code,152+m),cycleTime:1,byteLength:1,instruction:`SBC A, ${o.name}`,execute(){e.A.value=f(e.A.value,o.value,e.flags.CY)}})}),this.addOperation({get instruction(){return`SBC 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:222,cycleTime:2,byteLength:2,execute(){const o=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=f(e.A.value,o,e.flags.CY)}}),this.addOperation({instruction:"SBC A, (HL)",byteDefinition:158,cycleTime:2,byteLength:1,execute(){const o=i.memory.readByte(e.HL.value);e.A.value=f(e.A.value,o,e.flags.CY)}})}},7294:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCallAndReturnOperations=void 0;const i=r(8254);var e;(function(s){s[s.NZ=0]="NZ",s[s.Z=1]="Z",s[s.NC=2]="NC",s[s.C=3]="C"})(e||(e={})),t.createCallAndReturnOperations=function(){const{registers:s}=this,n=this;function d(o){return 192+(o<<3)+4}function c(o){return 192+(o<<3)}function u(o){return 192+(o<<3)+7}this.addOperation({get instruction(){return`CALL 0x${i.memory.readWord(s.programCounter.value).toString(16)}`},byteDefinition:205,byteLength:3,cycleTime:6,execute(){const o=i.memory.readWord(s.programCounter.value);s.programCounter.value+=2;const m=s.programCounter.value;n.pushToStack(m),s.programCounter.value=o}}),this.addOperation({get instruction(){return`CALL NZ, 0x${i.memory.readWord(s.programCounter.value).toString(16)}`},byteDefinition:d(e.NZ),byteLength:3,get cycleTime(){return s.flags.isResultZero?3:6},execute(){if(s.flags.isResultZero)s.programCounter.value+=2;else{const o=i.memory.readWord(s.programCounter.value);s.programCounter.value+=2;const m=s.programCounter.value;n.pushToStack(m),s.programCounter.value=o}}}),this.addOperation({get instruction(){return`CALL Z, 0x${i.memory.readWord(s.programCounter.value).toString(16)}`},byteDefinition:d(e.Z),byteLength:3,get cycleTime(){return s.flags.isResultZero?6:3},execute(){if(s.flags.isResultZero){const o=i.memory.readWord(s.programCounter.value);s.programCounter.value+=2;const m=s.programCounter.value;n.pushToStack(m),s.programCounter.value=o}else s.programCounter.value+=2}}),this.addOperation({get instruction(){return`CALL NC, 0x${i.memory.readWord(s.programCounter.value).toString(16)}`},byteDefinition:d(e.NC),byteLength:3,get cycleTime(){return s.flags.isCarry?3:6},execute(){if(s.flags.isCarry)s.programCounter.value+=2;else{const o=i.memory.readWord(s.programCounter.value);s.programCounter.value+=2;const m=s.programCounter.value;n.pushToStack(m),s.programCounter.value=o}}}),this.addOperation({get instruction(){return`CALL C, 0x${i.memory.readWord(s.programCounter.value).toString(16)}`},byteDefinition:d(e.C),byteLength:3,get cycleTime(){return s.flags.isCarry?6:3},execute(){if(s.flags.isCarry){const o=i.memory.readWord(s.programCounter.value);s.programCounter.value+=2;const m=s.programCounter.value;n.pushToStack(m),s.programCounter.value=o}else s.programCounter.value+=2}}),this.addOperation({instruction:"RET",byteDefinition:201,byteLength:1,cycleTime:4,execute(){s.programCounter.value=n.popFromStack()}}),this.addOperation({instruction:"RETI",byteDefinition:217,byteLength:1,cycleTime:4,execute(){s.programCounter.value=n.popFromStack(),n.isInterruptMasterEnable=!0}}),this.addOperation({instruction:"RET NZ",byteDefinition:c(e.NZ),byteLength:1,get cycleTime(){return s.flags.isResultZero?2:5},execute(){s.flags.isResultZero||(s.programCounter.value=n.popFromStack())}}),this.addOperation({instruction:"RET Z",byteDefinition:c(e.Z),byteLength:1,get cycleTime(){return s.flags.isResultZero?5:2},execute(){s.flags.isResultZero&&(s.programCounter.value=n.popFromStack())}}),this.addOperation({instruction:"RET NC",byteDefinition:c(e.NC),byteLength:1,get cycleTime(){return s.flags.isCarry?2:5},execute(){s.flags.isCarry||(s.programCounter.value=n.popFromStack())}}),this.addOperation({instruction:"RET C",byteDefinition:c(e.C),byteLength:1,get cycleTime(){return s.flags.isCarry?5:2},execute(){s.flags.isCarry&&(s.programCounter.value=n.popFromStack())}});const f=[0,8,16,24,32,40,48,56];for(let o=0;o<8;o++)this.addOperation({byteDefinition:u(o),instruction:`RST ${o}`,byteLength:1,cycleTime:4,execute(){n.pushToStack(s.programCounter.value),s.programCounter.value=f[o]}})}},927:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createGeneralPurposeOperations=void 0,t.createGeneralPurposeOperations=function(){const{registers:r}=this;this.addOperation({instruction:"DAA",byteDefinition:39,cycleTime:1,byteLength:1,execute(){const{A:i,flags:e}=r,s=e.isSubtraction?-6:6,n=e.isSubtraction?-96:96,d=!e.isSubtraction&&(15&i.value)>9,c=!e.isSubtraction&&i.value>153;(e.isHalfCarry||d)&&(i.value+=s),(e.isCarry||c)&&(i.value+=n,e.isCarry=!0),e.isResultZero=i.value===0,e.isHalfCarry=!1}}),this.addOperation({instruction:"CPL",byteDefinition:47,cycleTime:1,byteLength:1,execute(){r.A.value=~r.A.value,r.flags.isHalfCarry=!0,r.flags.isSubtraction=!0}}),this.addOperation({instruction:"NOP",byteDefinition:0,cycleTime:1,byteLength:1,execute(){}}),this.addOperation({instruction:"CCF",byteDefinition:63,cycleTime:1,byteLength:1,execute(){r.flags.isSubtraction=!1,r.flags.isHalfCarry=!1,r.flags.isCarry=!r.flags.isCarry}}),this.addOperation({instruction:"SCF",byteDefinition:55,cycleTime:1,byteLength:1,execute(){r.flags.isSubtraction=!1,r.flags.isHalfCarry=!1,r.flags.isCarry=!0}}),this.addOperation({instruction:"HALT",byteDefinition:118,cycleTime:1,byteLength:1,execute:()=>{this.halt()}}),this.addOperation({instruction:"STOP",byteDefinition:16,cycleTime:1,byteLength:1,execute:()=>{this.stop()}})}},9904:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createInputOutputOperations=void 0;const i=r(8254);t.createInputOutputOperations=function(){const{registers:e}=this;this.registers.baseRegisters.forEach(s=>{var n;this.addOperation({byteDefinition:(n=s.code,64+(n<<3)+6),instruction:`LD ${s.name}, (HL)`,cycleTime:2,byteLength:1,execute(){s.value=i.memory.readByte(e.HL.value)}})}),this.addOperation({instruction:"LD A, (BC)",byteDefinition:10,cycleTime:2,byteLength:1,execute(){e.A.value=i.memory.readByte(e.BC.value)}}),this.addOperation({instruction:"LD A, (DE)",byteDefinition:26,cycleTime:2,byteLength:1,execute(){e.A.value=i.memory.readByte(e.DE.value)}}),this.addOperation({instruction:"LD A, (C)",byteDefinition:242,cycleTime:2,byteLength:1,execute(){e.A.value=i.memory.readByte(65280+e.C.value)}}),this.addOperation({get instruction(){return`LD A, (0x${i.memory.readByte(e.programCounter.value).toString(16)})`},byteDefinition:240,cycleTime:3,byteLength:2,execute(){const s=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=i.memory.readByte(65280+s)}}),this.addOperation({get instruction(){return`LD A, (0x${i.memory.readWord(e.programCounter.value).toString(16)})`},byteDefinition:250,cycleTime:4,byteLength:3,execute(){const s=i.memory.readWord(e.programCounter.value);e.programCounter.value+=2,e.A.value=i.memory.readByte(s)}}),this.addOperation({instruction:"LD A, (HLI)",byteDefinition:42,cycleTime:2,byteLength:1,execute(){e.A.value=i.memory.readByte(e.HL.value),e.HL.value++}}),this.addOperation({instruction:"LD A, (HLD)",byteDefinition:58,cycleTime:2,byteLength:1,execute(){e.A.value=i.memory.readByte(e.HL.value),e.HL.value--}}),this.registers.baseRegisters.forEach(s=>{var n;this.addOperation({byteDefinition:(n=s.code,112+n),instruction:`LD (HL), ${s.name}`,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(e.HL.value,s.value)}})}),this.addOperation({instruction:"LD (C), A",byteDefinition:226,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(65280+e.C.value,e.A.value)}}),this.addOperation({get instruction(){return`LD (0x${i.memory.readByte(e.programCounter.value).toString(16)}), A`},byteDefinition:224,cycleTime:3,byteLength:2,execute(){const s=i.memory.readByte(e.programCounter.value);e.programCounter.value++,i.memory.writeByte(65280+s,e.A.value)}}),this.addOperation({get instruction(){return`LD (0x${i.memory.readWord(e.programCounter.value).toString(16)}), A`},byteDefinition:234,cycleTime:4,byteLength:3,execute(){const s=i.memory.readWord(e.programCounter.value);e.programCounter.value+=2,i.memory.writeByte(s,e.A.value)}}),this.addOperation({instruction:"LD (BC), A",byteDefinition:2,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(e.BC.value,e.A.value)}}),this.addOperation({instruction:"LD (DE), A",byteDefinition:18,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(e.DE.value,e.A.value)}}),this.addOperation({instruction:"LD (HLI), A",byteDefinition:34,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(e.HL.value,e.A.value),e.HL.value=e.HL.value+1}}),this.addOperation({instruction:"LD (HLD), A",byteDefinition:50,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(e.HL.value,e.A.value),e.HL.value=e.HL.value-1}}),e.baseRegisters.forEach(s=>{e.baseRegisters.forEach(n=>{var d,c;this.addOperation({byteDefinition:(d=s.code,c=n.code,64+(d<<3)+c),instruction:`LD ${s.name}, ${n.name}`,byteLength:1,cycleTime:2,execute(){s.value=n.value}})})}),this.addOperation({get instruction(){return`LD (HL), 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:54,cycleTime:3,byteLength:2,execute(){const s=i.memory.readByte(e.programCounter.value);e.programCounter.value++,i.memory.writeByte(e.HL.value,s)}}),this.registers.baseRegisters.forEach(s=>{var n;this.addOperation({get instruction(){return`LD ${s.name}, 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:(n=s.code,6+(n<<3)),cycleTime:2,byteLength:2,execute(){s.value=i.memory.readByte(e.programCounter.value),e.programCounter.value++}})}),this.addOperation({get instruction(){return`LD (0x${i.memory.readWord(e.programCounter.value).toString(16)}), SP`},byteDefinition:8,cycleTime:5,byteLength:3,execute(){const s=i.memory.readWord(e.programCounter.value);i.memory.writeWord(s,e.stackPointer.value),e.programCounter.value+=2}}),e.registerPairs.filter(s=>s.name!=="AF").forEach(s=>{var n;this.addOperation({get instruction(){return`LD ${s.name}, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:(n=s.code,1+(n<<4)),cycleTime:3,byteLength:3,execute(){s.value=i.memory.readWord(e.programCounter.value),e.programCounter.value+=2}})}),this.addOperation({instruction:"LD SP, HL",byteDefinition:249,cycleTime:2,byteLength:1,execute(){e.stackPointer.value=e.HL.value}}),e.registerPairs.filter(s=>s.name!=="SP").forEach(s=>{var n;this.addOperation({instruction:`PUSH ${s.name}`,byteDefinition:(n=s.code,192+(n<<4)+5),byteLength:1,cycleTime:4,execute:()=>{this.pushToStack(s.value)}})}),e.registerPairs.filter(s=>s.name!=="SP").forEach(s=>{var n;this.addOperation({instruction:`POP ${s.name}`,byteDefinition:(n=s.code,192+(n<<4)+1),byteLength:1,cycleTime:3,execute:()=>{s.value=this.popFromStack()}})}),this.addOperation({byteDefinition:248,get instruction(){const s=i.memory.readSignedByte(e.programCounter.value);return s>=0?`LDHL SP,  0x${s.toString(16)}`:`LDHL SP,  -0x${(-1*s).toString(16)}`},byteLength:2,cycleTime:3,execute(){const s=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++;const n=15-(15&e.stackPointer.value),d=255-(255&e.stackPointer.value);e.flags.isHalfCarry=(15&s)>n,e.flags.isCarry=(255&s)>d,e.flags.isResultZero=!1,e.flags.isSubtraction=!1,e.HL.value=e.stackPointer.value+s}})}},5494:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createInterruptOperations=void 0,t.createInterruptOperations=function(){const r=this;this.addOperation({instruction:"EI",byteDefinition:251,byteLength:1,cycleTime:1,execute(){r.isInterruptMasterEnable=!0}}),this.addOperation({instruction:"DI",byteDefinition:243,byteLength:1,cycleTime:1,execute(){r.isInterruptMasterEnable=!1}})}},1456:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createJumpOperations=void 0;const i=r(8254);t.createJumpOperations=function(){const{registers:e}=this;this.addOperation({get instruction(){return`JP 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:195,cycleTime:4,byteLength:3,execute(){e.programCounter.value=i.memory.readWord(e.programCounter.value)}}),this.addOperation({get instruction(){return`JP NZ, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:194,get cycleTime(){return e.flags.isResultZero?3:4},byteLength:3,execute(){e.flags.isResultZero?e.programCounter.value+=2:e.programCounter.value=i.memory.readWord(e.programCounter.value)}}),this.addOperation({get instruction(){return`JP Z, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:202,get cycleTime(){return e.flags.isResultZero?4:3},byteLength:3,execute(){e.flags.isResultZero?e.programCounter.value=i.memory.readWord(e.programCounter.value):e.programCounter.value+=2}}),this.addOperation({get instruction(){return`JP NC, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:210,get cycleTime(){return e.flags.isCarry?3:4},byteLength:3,execute(){e.flags.isCarry?e.programCounter.value+=2:e.programCounter.value=i.memory.readWord(e.programCounter.value)}}),this.addOperation({get instruction(){return`JP C, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:218,get cycleTime(){return e.flags.isCarry?4:3},byteLength:3,execute(){e.flags.isCarry?e.programCounter.value=i.memory.readWord(e.programCounter.value):e.programCounter.value+=2}}),this.addOperation({get instruction(){const s=i.memory.readSignedByte(e.programCounter.value);return s>=0?`JR 0x${s.toString(16)}`:`JR -0x${(-1*s).toString(16)}`},byteDefinition:24,cycleTime:3,byteLength:2,execute(){const s=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+s}}),this.addOperation({get instruction(){const s=i.memory.readSignedByte(e.programCounter.value);return s>=0?`JR NZ 0x${s.toString(16)}`:`JR NZ -0x${(-1*s).toString(16)}`},byteDefinition:32,cycleTime:e.flags.isResultZero?2:3,byteLength:2,execute(){if(e.flags.isResultZero)e.programCounter.value++;else{const s=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+s}}}),this.addOperation({get instruction(){const s=i.memory.readSignedByte(e.programCounter.value);return s>=0?`JR Z 0x${s.toString(16)}`:`JR Z -0x${(-1*s).toString(16)}`},byteDefinition:40,cycleTime:e.flags.isResultZero?3:2,byteLength:2,execute(){if(e.flags.isResultZero){const s=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+s}else e.programCounter.value++}}),this.addOperation({get instruction(){const s=i.memory.readSignedByte(e.programCounter.value);return s>=0?`JR NC 0x${s.toString(16)}`:`JR NC -0x${(-1*s).toString(16)}`},byteDefinition:48,cycleTime:e.flags.isCarry?2:3,byteLength:2,execute(){if(e.flags.isCarry)e.programCounter.value++;else{const s=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+s}}}),this.addOperation({get instruction(){const s=i.memory.readSignedByte(e.programCounter.value);return s>=0?`JR C 0x${s.toString(16)}`:`JR C -0x${(-1*s).toString(16)}`},byteDefinition:56,cycleTime:e.flags.isCarry?3:2,byteLength:2,execute(){if(e.flags.isCarry){const s=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+s}else e.programCounter.value++}}),this.addOperation({instruction:" JP (HL)",byteDefinition:233,cycleTime:1,byteLength:1,execute(){e.programCounter.value=e.HL.value}})}},7300:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLogicalOperations=void 0;const i=r(8254);t.createLogicalOperations=function(){const{registers:e}=this;function s(u,f){const o=u&f&255;return e.flags.isCarry=!1,e.flags.isHalfCarry=!0,e.flags.isSubtraction=!1,e.flags.isResultZero=o===0,o}function n(u,f){const o=u-f&255;e.flags.isResultZero=o===0,e.flags.isHalfCarry=(15&u)<(15&f),e.flags.isSubtraction=!0,e.flags.isCarry=u<f}function d(u,f){const o=255&(u|f);return e.flags.isCarry=!1,e.flags.isHalfCarry=!1,e.flags.isSubtraction=!1,e.flags.isResultZero=o===0,o}function c(u,f){const o=255&(u^f);return e.flags.isCarry=!1,e.flags.isHalfCarry=!1,e.flags.isSubtraction=!1,e.flags.isResultZero=o===0,o}this.registers.baseRegisters.forEach(u=>{var f;this.addOperation({byteDefinition:(f=u.code,160+f),cycleTime:1,byteLength:1,instruction:`AND ${u.name}`,execute(){e.A.value=s(e.A.value,u.value)}})}),this.addOperation({byteDefinition:230,cycleTime:2,byteLength:2,get instruction(){return`AND 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const u=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=s(e.A.value,u)}}),this.addOperation({byteDefinition:166,cycleTime:2,byteLength:1,get instruction(){return`AND 0x${i.memory.readByte(e.HL.value).toString(16)}`},execute(){const u=i.memory.readByte(e.HL.value);e.A.value=s(e.A.value,u)}}),this.registers.baseRegisters.forEach(u=>{var f;this.addOperation({instruction:`CP ${u.name}`,byteDefinition:(f=u.code,184+f),cycleTime:1,byteLength:1,execute(){n(e.A.value,u.value)}})}),this.addOperation({get instruction(){return`CP 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:254,cycleTime:2,byteLength:2,execute(){const u=i.memory.readByte(e.programCounter.value);e.programCounter.value++,n(e.A.value,u)}}),this.addOperation({instruction:"CP (HL)",byteDefinition:190,cycleTime:2,byteLength:1,execute(){const u=i.memory.readByte(e.HL.value);n(e.A.value,u)}}),this.registers.baseRegisters.forEach(u=>{var f;this.addOperation({byteDefinition:(f=u.code,176+f),cycleTime:1,byteLength:1,instruction:`OR ${u.name}`,execute(){e.A.value=d(e.A.value,u.value)}})}),this.addOperation({byteDefinition:246,cycleTime:2,byteLength:2,get instruction(){return`OR 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const u=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=d(e.A.value,u)}}),this.addOperation({byteDefinition:182,cycleTime:2,byteLength:1,instruction:"OR (HL)",execute(){const u=i.memory.readByte(e.HL.value);e.A.value=d(e.A.value,u)}}),this.registers.baseRegisters.forEach(u=>{var f;this.addOperation({instruction:`XOR ${u.name}`,byteDefinition:(f=u.code,168+f),cycleTime:1,byteLength:1,execute(){e.A.value=c(e.A.value,u.value)}})}),this.addOperation({get instruction(){return`XOR 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:238,cycleTime:2,byteLength:2,execute(){const u=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=c(e.A.value,u)}}),this.addOperation({instruction:"XOR (HL)",byteDefinition:174,cycleTime:2,byteLength:1,execute(){const u=i.memory.readByte(e.HL.value);e.A.value=c(e.A.value,u)}})}},9879:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRotateShiftOperations=void 0,t.createRotateShiftOperations=function(){const{registers:r}=this;this.addOperation({instruction:"RLCA",byteDefinition:7,cycleTime:1,byteLength:1,execute(){const i=r.A.value>>7;r.flags.CY=i,r.flags.H=0,r.flags.Z=0,r.flags.N=0,r.A.value=(r.A.value<<1)+i}}),this.addOperation({instruction:"RLA",byteDefinition:23,cycleTime:1,byteLength:1,execute(){const i=r.A.value>>7,e=(r.A.value<<1)+r.flags.CY;r.flags.CY=i,r.flags.H=0,r.flags.N=0,r.flags.Z=0,r.A.value=e}}),this.addOperation({instruction:"RRCA",byteDefinition:15,cycleTime:1,byteLength:1,execute(){const i=1&r.A.value;r.flags.CY=i,r.flags.H=0,r.flags.Z=0,r.flags.N=0,r.A.value=(r.A.value>>1)+(i<<7)}}),this.addOperation({instruction:"RRA",byteDefinition:31,cycleTime:1,byteLength:1,execute(){const i=1&r.A.value,e=(r.A.value>>1)+(r.flags.CY<<7);r.flags.CY=i,r.flags.H=0,r.flags.N=0,r.flags.Z=0,r.A.value=e}})}},9080:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dividerRegister=t.DividerRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65284,this.name="DIV"}setValueFromCpuDivider(n){i.memory.writeByte(this.offset,n)}get value(){return i.memory.readByte(this.offset)}set value(n){i.memory.writeByte(this.offset,0)}}t.DividerRegister=e,t.dividerRegister=new e},9099:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.interruptEnableRegister=void 0;const i=r(8254);t.interruptEnableRegister=new class{constructor(){this.offset=65535,this.name="IE"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}}},8543:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.interruptRequestRegister=void 0;const i=r(8254),e=r(5425);t.interruptRequestRegister=new class{constructor(){this.offset=65295,this.name="IF"}get value(){return i.memory.readByte(this.offset)}set value(s){i.memory.writeByte(this.offset,s)}triggerVBlankInterruptRequest(){this.value=e.setBit(this.value,0,1)}triggerLcdStatusInterruptRequest(){this.value=e.setBit(this.value,1,1)}triggerTimerInterruptRequest(){this.value=e.setBit(this.value,2,1)}clearVBlankInterruptRequest(){this.value=e.clearBit(this.value,0)}clearLcdStatusInterruptRequest(){this.value=e.clearBit(this.value,1)}clearTimerOverflowInterruptRequest(){this.value=e.clearBit(this.value,2)}clearSerialTransferInterruptRequest(){this.value=e.clearBit(this.value,3)}clearP10P13NegativeEdgeInterruptRequest(){this.value=e.clearBit(this.value,4)}getInterruptFlags(s){return{isVerticalBlanking:(1&s)==1,isLCDStatus:(s>>1&1)==1,isTimerOverflow:(s>>2&1)==1,isSerialTransferCompletion:(s>>3&1)==1,isP10P13NegativeEdge:(s>>4&1)==1}}}},6584:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timerControllerRegister=void 0;const i=r(8254);t.timerControllerRegister=new class{constructor(){this.offset=65287,this.name="TAC",this.inputClockSpeedValueToCycles=[1024,16,64,256]}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}get inputClockSpeed(){return 3&this.value}get cyclesForTimerUpdate(){return this.inputClockSpeedValueToCycles[this.inputClockSpeed]}get isTimerOn(){return(this.value>>2&1)==1}}},4002:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timerCounterRegister=t.TimerCounterRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65285,this.name="TIMA"}get value(){return i.memory.readByte(this.offset)}set value(n){i.memory.writeByte(this.offset,n)}}t.TimerCounterRegister=e,t.timerCounterRegister=new e},3120:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timerModuloRegister=t.TimerModuloRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65286,this.name="TMA"}get value(){return i.memory.readByte(this.offset)}set value(n){i.memory.writeByte(this.offset,n)}}t.TimerModuloRegister=e,t.timerModuloRegister=new e},1007:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GPU=void 0;const i=r(8254),e=r(4311),s=r(5425),n=r(2169),d=r(6681),c=r(1388),u=r(1659),f=r(8947),o=r(46),m=r(8224),b=r(3069),T=r(6396),S=r(2806),_=r(6685),D=r(8958),I=r(8543);class C{constructor(){this.cycleCounter=0,this.windowLinesDrawn=0,this.colors=[{red:255,green:255,blue:255},{red:192,green:192,blue:192},{red:96,green:96,blue:96},{red:0,green:0,blue:0}],this.screen=new e.EnhancedImageData(C.ScreenWidth,C.ScreenHeight)}tick(w){switch(this.cycleCounter+=w,u.lcdStatusRegister.mode){case n.LcdStatusMode.SearchingOAM:this.cycleCounter>=C.CyclesPerScanlineOam&&(this.cycleCounter%=C.CyclesPerScanlineOam,u.lcdStatusRegister.mode=n.LcdStatusMode.TransferringDataToLCD);break;case n.LcdStatusMode.TransferringDataToLCD:this.cycleCounter>=C.CyclesPerScanlineVram&&(this.cycleCounter%=C.CyclesPerScanlineVram,u.lcdStatusRegister.isHBlankInterruptSelected&&I.interruptRequestRegister.triggerLcdStatusInterruptRequest(),u.lcdStatusRegister.isLineYCompareMatching=f.lineYRegister.value===o.lineYCompareRegister.value,u.lcdStatusRegister.isLineYMatchingInterruptSelected&&u.lcdStatusRegister.isLineYCompareMatching&&I.interruptRequestRegister.triggerLcdStatusInterruptRequest(),u.lcdStatusRegister.mode=n.LcdStatusMode.InHBlank);break;case n.LcdStatusMode.InHBlank:this.cycleCounter>=C.CyclesPerHBlank&&(this.drawScanline(),this.cycleCounter%=C.CyclesPerHBlank,f.lineYRegister.value++,f.lineYRegister.value===C.ScreenHeight?(u.lcdStatusRegister.mode=n.LcdStatusMode.InVBlank,I.interruptRequestRegister.triggerVBlankInterruptRequest()):u.lcdStatusRegister.mode=n.LcdStatusMode.SearchingOAM);break;case n.LcdStatusMode.InVBlank:this.cycleCounter>=C.CyclesPerScanline&&(u.lcdStatusRegister.isLineYCompareMatching=f.lineYRegister.value===o.lineYCompareRegister.value,u.lcdStatusRegister.isLineYMatchingInterruptSelected&&u.lcdStatusRegister.isLineYCompareMatching&&I.interruptRequestRegister.triggerLcdStatusInterruptRequest(),f.lineYRegister.value++,this.cycleCounter%=C.CyclesPerScanline,f.lineYRegister.value===C.HeightIncludingOffscreen&&(u.lcdStatusRegister.mode=n.LcdStatusMode.SearchingOAM,f.lineYRegister.value=0,this.windowLinesDrawn=0))}}drawScanline(){if(!m.lcdControlRegister.isLCDControllerOperating)return;let w=[];m.lcdControlRegister.isBackgroundDisplayOn&&(w=this.drawBackgroundLine());let B=[];m.lcdControlRegister.isWindowingOn&&(B=this.drawWindowLine()),m.lcdControlRegister.isObjOn&&this.drawSpriteLine(w,B)}drawBackgroundLine(){const w=[],B=m.lcdControlRegister.backgroundCharacterDataStartAddress,{backgroundTileMapStartAddress:A,backgroundCharacterData:R}=m.lcdControlRegister,P=R===0?i.memory.readSignedByte:i.memory.readByte,M=b.backgroundPaletteRegister.backgroundPalette,k=s.asUint8(f.lineYRegister.value+T.scrollYRegister.value);for(let L=0;L<C.ScreenWidth;L++)if(m.lcdControlRegister.isBackgroundDisplayOn){const H=s.asUint8(L+S.scrollXRegister.value),$=this.getTileIndexFromPixelLocation(H,k),X=this.getUpperLeftPixelLocationOfTile($),te=H-X.x,ce=2*(k-X.y),fe=m.lcdControlRegister.backgroundCharacterData===0?128:0,q=B+16*(P(A+$)+fe)+ce,re=i.memory.readByte(q),de=i.memory.readByte(q+1),Y=this.getPixelInTileLine(te,re,de,!1);w.push(Y);const Q=M[Y],V=this.colors[Q];this.screen.setPixel(L,f.lineYRegister.value,V.red,V.green,V.blue)}else{const H=M[0],$=this.colors[H];w.push(0),this.screen.setPixel(L,f.lineYRegister.value,$.red,$.green,$.blue)}return w}drawWindowLine(){if(f.lineYRegister.value<d.windowYRegister.value||c.windowXRegister.value>166)return[];const w=[];let B;const A=m.lcdControlRegister.windowTileMapStartAddress,R=m.lcdControlRegister.backgroundCharacterDataStartAddress,P=b.backgroundPaletteRegister.backgroundPalette;if(m.lcdControlRegister.backgroundCharacterData===0){const L=i.memory.memoryBytes.subarray(A,A+4096);B=new Int8Array(L)}else B=i.memory.memoryBytes.subarray(A,A+4096);const M=this.windowLinesDrawn,k=c.windowXRegister.value-7;for(let L=0;L<C.ScreenWidth;L++){if(L<k){w.push(0);continue}const H=L-k,$=this.getTileIndexFromPixelLocation(H,M),X=this.getUpperLeftPixelLocationOfTile($),te=H-X.x,ce=2*(M-X.y),fe=m.lcdControlRegister.backgroundCharacterData===0?128:0,q=R+16*(B[$]+fe)+ce,re=i.memory.readByte(q),de=i.memory.readByte(q+1),Y=this.getPixelInTileLine(te,re,de,!1);w.push(Y);const Q=P[Y],V=this.colors[Q];this.screen.setPixel(L,f.lineYRegister.value,V.red,V.green,V.blue)}return this.windowLinesDrawn++,w}drawSpriteLine(w,B){_.objectAttributeMemoryRegisters.filter(A=>{const{xPosition:R,yPosition:P}=A;if(R===0||P==0||R>=168||P>=160)return!1;const M=P+-16;let k=f.lineYRegister.value-M;const L=m.lcdControlRegister.objectHeight-1;return A.isFlippedVertical&&(k=L-k),k>=0&&k<=L}).slice(0,10).reverse().sort((A,R)=>R.xPosition-A.xPosition).forEach(A=>{const{xPosition:R,yPosition:P,characterCode:M,paletteNumber:k}=A,L=R+-8,H=P+-16;let $=f.lineYRegister.value-H;const X=m.lcdControlRegister.objectHeight-1;A.isFlippedVertical&&($=X-$);const te=32768+16*(m.lcdControlRegister.objectHeight===16?s.clearBit(M,0):M)+2*$,ce=i.memory.readByte(te),fe=i.memory.readByte(te+1);for(let q=0;q<8;q++){const re=this.getPixelInTileLine(q,ce,fe,A.isFlippedHorizontal),de=D.objectPaletteRegisters[k].palette[re],Y=this.colors[de],Q=L+q,V=w[Q]!==0,Lt=B[Q]!==void 0&&B[Q]!==0,Dt=A.isBehindBackground&&(V||Lt);re===0||Dt||this.screen.setPixel(L+q,f.lineYRegister.value,Y.red,Y.green,Y.blue)}})}getTileIndexFromPixelLocation(w,B){const A=Math.floor(w/8);return 32*Math.floor(B/8)+A}getUpperLeftPixelLocationOfTile(w){const B=Math.floor(w/32);return{x:8*(w-32*B),y:8*B}}getPixelInTileLine(w,B,A,R){const P=R?w:7-w;return s.getBit(B,P)+(s.getBit(A,P)<<1)}}t.GPU=C,C.ScreenWidth=160,C.ScreenHeight=144,C.HeightIncludingOffscreen=154,C.CyclesPerHBlank=204,C.CyclesPerScanlineOam=80,C.CyclesPerScanlineVram=172,C.CyclesPerScanline=C.CyclesPerHBlank+C.CyclesPerScanlineOam+C.CyclesPerScanlineVram,C.CyclesPerVBlank=4560,C.ScanlinesPerFrame=144,C.CyclesPerFrame=C.CyclesPerScanline*C.ScanlinesPerFrame+C.CyclesPerVBlank},3069:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.backgroundPaletteRegister=void 0;const i=r(8254);t.backgroundPaletteRegister=new class{constructor(){this.offset=65351,this.name="BGP"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}get backgroundPalette(){const e=this.value;return[3&e,e>>2&3,e>>4&3,e>>6&3]}}},8078:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dmaTransferRegister=void 0;const i=r(8254);t.dmaTransferRegister=new class{constructor(){this.offset=65350,this.name="DMA"}get value(){return i.memory.readByte(this.offset)}}},8224:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lcdControlRegister=void 0;const i=r(8254),e=r(5425);t.lcdControlRegister=new class{constructor(){this.offset=65344,this.name="LCDC"}get value(){return i.memory.readByte(this.offset)}set value(s){i.memory.writeByte(this.offset,s)}get isBackgroundDisplayOn(){return e.getBit(this.value,0)===1}get isObjOn(){return e.getBit(this.value,1)===1}get objectHeight(){return e.getBit(this.value,2)===0?8:16}get backgroundCodeArea(){return e.getBit(this.value,3)}get backgroundCharacterData(){return e.getBit(this.value,4)}get windowCharacterData(){return this.backgroundCharacterData}get isWindowingOn(){return e.getBit(this.value,5)===1}get windowCodeArea(){return e.getBit(this.value,6)}get windowTileMapStartAddress(){return this.windowCodeArea===0?38912:39936}get backgroundTileMapStartAddress(){return this.backgroundCodeArea===0?38912:39936}get backgroundCharacterDataStartAddress(){return this.backgroundCharacterData===0?34816:32768}get isLCDControllerOperating(){return e.getBit(this.value,7)===1}}},2169:(h,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LcdStatusMode=void 0,(r=t.LcdStatusMode||(t.LcdStatusMode={}))[r.InHBlank=0]="InHBlank",r[r.InVBlank=1]="InVBlank",r[r.SearchingOAM=2]="SearchingOAM",r[r.TransferringDataToLCD=3]="TransferringDataToLCD"},1659:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lcdStatusRegister=void 0;const i=r(8254),e=r(5425);t.lcdStatusRegister=new class{constructor(){this.offset=65345,this.name="STAT"}get value(){return i.memory.readByte(this.offset)}set value(s){i.memory.writeByte(this.offset,s)}get mode(){return 3&this.value}set mode(s){let n=this.value;n=e.setBit(n,0,1&s),n=e.setBit(n,1,s>>1&1),this.value=n}get isLineYCompareMatching(){return e.getBit(this.value,2)===1}set isLineYCompareMatching(s){this.value=e.setBit(this.value,2,s?1:0)}get isHBlankInterruptSelected(){return e.getBit(this.value,3)}get isLineYMatchingInterruptSelected(){return e.getBit(this.value,6)}}},46:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lineYCompareRegister=t.LineYCompareRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65349,this.name="LYC"}get value(){return i.memory.readByte(this.offset)}set value(n){i.memory.writeByte(this.offset,n)}}t.LineYCompareRegister=e,t.lineYCompareRegister=new e},8947:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lineYRegister=t.LineYRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65348,this.name="LY"}get value(){return i.memory.readByte(this.offset)}set value(n){i.memory.writeByte(this.offset,n)}}t.LineYRegister=e,t.lineYRegister=new e},6685:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectAttributeMemoryRegisters=t.ObjectAttributeMemoryRegister=void 0;const i=r(8254);class e{constructor(n){this.offset=n+e.StartOffset,this.name="OBJ"+n}getValueAt(n){if(n>=e.BytesPerRegister)throw new Error(`${this.name} Index out of bounds`);return i.memory.readByte(this.offset+n)}get yPosition(){return this.getValueAt(0)}get xPosition(){return this.getValueAt(1)}get characterCode(){return this.getValueAt(2)}get paletteNumber(){return this.getValueAt(3)>>4&1}get isFlippedHorizontal(){return(this.getValueAt(3)>>5&1)==1}get isFlippedVertical(){return(this.getValueAt(3)>>6&1)==1}get isBehindBackground(){return(this.getValueAt(3)>>7&1)==1}}t.ObjectAttributeMemoryRegister=e,e.StartOffset=65024,e.EndOffset=65183,e.BytesPerRegister=4,t.objectAttributeMemoryRegisters=function(){const s=[],n=e.EndOffset-e.StartOffset;for(let d=0;d<=n;d+=e.BytesPerRegister)s.push(new e(d));return s}()},8958:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectPaletteRegisters=t.ObjectPaletteRegister=void 0;const i=r(8254);class e{constructor(n){this.offset=e.StartOffset+n,this.name="OBP"+n}get value(){return i.memory.readByte(this.offset)}set value(n){i.memory.writeByte(this.offset,n)}get palette(){const n=this.value;return[3&n,n>>2&3,n>>4&3,n>>6&3]}}t.ObjectPaletteRegister=e,e.StartOffset=65352,t.objectPaletteRegisters=[new e(0),new e(1)]},2806:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scrollXRegister=t.ScrollXRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65347,this.name="SCX"}get value(){return i.memory.readByte(this.offset)}set value(n){i.memory.writeByte(this.offset,n)}}t.ScrollXRegister=e,t.scrollXRegister=new e},6396:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scrollYRegister=t.ScrollYRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65346,this.name="SCY"}get value(){return i.memory.readByte(this.offset)}set value(n){i.memory.writeByte(this.offset,n)}}t.ScrollYRegister=e,t.scrollYRegister=new e},1388:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.windowXRegister=t.WindowXRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65355,this.name="WX"}get value(){return i.memory.readByte(this.offset)}set value(n){i.memory.writeByte(this.offset,n)}}t.WindowXRegister=e,t.windowXRegister=new e},6681:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.windowYRegister=t.WindowYRegister=void 0;const i=r(8254);class e{constructor(){this.offset=65354,this.name="WY"}get value(){return i.memory.readByte(this.offset)}set value(n){i.memory.writeByte(this.offset,n)}}t.WindowYRegister=e,t.windowYRegister=new e},5425:(h,t)=>{function r(e,s){return e&~(1<<s)}function i(e){return 255&e}Object.defineProperty(t,"__esModule",{value:!0}),t.getUpperNibble=t.getLowerNibble=t.getMostSignificantByte=t.getLeastSignificantByte=t.convertUint8ToInt8=t.asUint16=t.asUint8=t.setBit=t.clearBit=t.getBit=void 0,t.getBit=function(e,s){return e>>s&1},t.clearBit=r,t.setBit=function(e,s,n){let d=r(e,s);return n===1&&(d|=1<<s),d},t.asUint8=i,t.asUint16=function(e){return 65535&e},t.convertUint8ToInt8=function(e){return i(e)<<24>>24},t.getLeastSignificantByte=function(e){return 255&e},t.getMostSignificantByte=function(e){return e>>8&255},t.getLowerNibble=function(e){return 15&e},t.getUpperNibble=function(e){return e>>4&15}},4311:(h,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedImageData=void 0;class r extends ImageData{setPixel(e,s,n,d,c,u=255){const f=s*this.width*4+4*e;this.data[f]=n,this.data[f+1]=d,this.data[f+2]=c,this.data[f+3]=u}}t.EnhancedImageData=r},2773:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.controllerManager=t.ControllerManager=t.Xbox360ControllerButtons=void 0;const i=r(7374);var e;(function(n){n[n.A=0]="A",n[n.B=1]="B",n[n.X=2]="X",n[n.Y=3]="Y",n[n.LeftBumper=4]="LeftBumper",n[n.RightBumper=5]="RightBumper",n[n.LeftTrigger=6]="LeftTrigger",n[n.RightTrigger=7]="RightTrigger",n[n.Select=8]="Select",n[n.Start=9]="Start",n[n.L3=10]="L3",n[n.R3=11]="R3",n[n.DpadUp=12]="DpadUp",n[n.DpadDown=13]="DpadDown",n[n.DpadLeft=14]="DpadLeft",n[n.DpadRight=15]="DpadRight"})(e=t.Xbox360ControllerButtons||(t.Xbox360ControllerButtons={}));class s{constructor(){this.controller=0,this.left=e.DpadLeft,this.right=e.DpadRight,this.up=e.DpadUp,this.down=e.DpadDown,this.select=e.Select,this.start=e.Start,this.b=e.X,this.a=e.A}queryButtons(){const d=navigator.getGamepads()[this.controller];d&&(i.input.isPressingLeft=d.buttons[this.left].pressed||d.axes[0]<-.1,i.input.isPressingRight=d.buttons[this.right].pressed||d.axes[0]>.1,i.input.isPressingUp=d.buttons[this.up].pressed||d.axes[1]<-.1,i.input.isPressingDown=d.buttons[this.down].pressed||d.axes[1]>.1,i.input.isPressingSelect=d.buttons[this.select].pressed,i.input.isPressingStart=d.buttons[this.start].pressed,i.input.isPressingB=d.buttons[this.b].pressed,i.input.isPressingA=d.buttons[this.a].pressed)}}t.ControllerManager=s,t.controllerManager=new s},7374:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.input=t.Input=void 0;const i=r(5425);class e{constructor(){this.isPressingUp=!1,this.isPressingDown=!1,this.isPressingLeft=!1,this.isPressingRight=!1,this.isPressingSelect=!1,this.isPressingStart=!1,this.isPressingA=!1,this.isPressingB=!1,this.isPollingDirections=!1,this.isPollingButtons=!1}setInputToCheck(n){this.isPollingButtons=(n>>4&1)==1,this.isPollingDirections=(n>>5&1)==1}reportInput(){let n=15;return this.isPollingDirections&&(n=i.setBit(n,0,this.isPressingRight?0:1),n=i.setBit(n,1,this.isPressingLeft?0:1),n=i.setBit(n,2,this.isPressingUp?0:1),n=i.setBit(n,3,this.isPressingDown?0:1)),this.isPollingButtons&&(n=i.setBit(n,0,this.isPressingA?0:1),n=i.setBit(n,1,this.isPressingB?0:1),n=i.setBit(n,2,this.isPressingSelect?0:1),n=i.setBit(n,3,this.isPressingStart?0:1)),n=i.setBit(n,4,this.isPollingButtons?0:1),n=i.setBit(n,5,this.isPollingDirections?0:1),n}}t.Input=e,t.input=new e},7202:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.keyboardManager=t.KeyboardManager=void 0;const i=r(7374);class e{constructor(){this.down="ArrowDown",this.up="ArrowUp",this.left="ArrowLeft",this.right="ArrowRight",this.a="KeyA",this.b="KeyB",this.start="Enter",this.select="ControlRight",document.addEventListener("keydown",n=>this.handleKeyEvent(n.code,!0)),document.addEventListener("keyup",n=>this.handleKeyEvent(n.code,!1))}handleKeyEvent(n,d){n===this.down&&(i.input.isPressingDown=d),n===this.up&&(i.input.isPressingUp=d),n===this.left&&(i.input.isPressingLeft=d),n===this.right&&(i.input.isPressingRight=d),n===this.a&&(i.input.isPressingA=d),n===this.b&&(i.input.isPressingB=d),n===this.start&&(i.input.isPressingStart=d),n===this.select&&(i.input.isPressingSelect=d)}}t.KeyboardManager=e,t.keyboardManager=new e},5281:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.controllerDataRegister=void 0;const i=r(8254);t.controllerDataRegister=new class{constructor(){this.offset=65280,this.name="P1"}get value(){return i.memory.readByte(this.offset)}get isPollingDirections(){return i.memory.readByte(this.offset)>>4&1}get isPollingButtons(){return i.memory.readByte(this.offset)>>5&1}}},3084:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dmaTransferController=void 0;const i=r(6685),e=r(8254),s=r(8078);class n{transfer(){const c=s.dmaTransferRegister.value*n.AddressInterval,u=i.objectAttributeMemoryRegisters.length*i.ObjectAttributeMemoryRegister.BytesPerRegister;for(let f=0;f<u;f++){const o=e.memory.readByte(c+f);e.memory.writeByte(i.ObjectAttributeMemoryRegister.StartOffset+f,o)}}}n.AddressInterval=256,t.dmaTransferController=new n},8254:(h,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.memory=t.Memory=void 0;const i=r(3084),e=r(7374),s=r(9080),n=r(8078),d=r(5281),c=new ArrayBuffer(65536),u=new DataView(c),f=new Uint8Array(c);class o{insertCartridge(S){this.cartridge=S}get memoryBytes(){return f}reset(){f.fill(0,0,f.length-1)}readByte(S){return m(S)?this.cartridge?this.cartridge.readByte(S):0:b(S)?e.input.reportInput():u.getUint8(S)}readSignedByte(S){return m(S)?this.cartridge?this.cartridge.readSignedByte(S):0:u.getInt8(S)}readWord(S){return m(S)?this.cartridge?this.cartridge.readWord(S):0:u.getUint16(S,!0)}writeByte(S,_){var D;m(S)?(D=this.cartridge)==null||D.writeByte(S,_):b(S)?e.input.setInputToCheck(_):(S===s.dividerRegister.offset&&u.setUint8(s.dividerRegister.offset,0),u.setUint8(S,_),function(I){return I===n.dmaTransferRegister.offset}(S)&&i.dmaTransferController.transfer())}writeWord(S,_){var D;m(S)?(D=this.cartridge)==null||D.writeWord(S,_):u.setUint16(S,_,!0)}}function m(T){return T<=32767||T>=40960&&T<=49151}function b(T){return T===d.controllerDataRegister.offset}t.Memory=o,t.memory=new o}},g={};function v(h){if(g[h])return g[h].exports;var t=g[h]={exports:{}};return y[h].call(t.exports,t,t.exports,v),t.exports}v.d=(h,t)=>{for(var r in t)v.o(t,r)&&!v.o(h,r)&&Object.defineProperty(h,r,{enumerable:!0,get:t[r]})},v.o=(h,t)=>Object.prototype.hasOwnProperty.call(h,t),v.r=h=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})};var p={};return(()=>{var h=p;Object.defineProperty(h,"__esModule",{value:!0}),h.Gameboy=void 0;const t=v(1007),r=v(9145),i=v(8254),e=v(7374),s=v(5991),n=v(8224),d=v(2773),c=v(3426),u=v(7189),f=v(7202);h.Gameboy=class{constructor(){this.cpu=new r.CPU,this.gpu=new t.GPU,this.apu=new s.APU,this.memory=i.memory,this.fps=0,this.input=e.input,this.controllerManager=d.controllerManager,this.keyboardManager=f.keyboardManager,this.maxFps=60,this.interval=1e3/this.maxFps,this.cycles=0,this.previousTime=0}run(){this.cpu.initialize(),i.memory.reset(),n.lcdControlRegister.value=131,requestAnimationFrame(o=>this.runFrame(o))}runFrame(o){const m=o-this.previousTime;if(m>=this.interval||!this.previousTime){for(this.fps=1e3/(o-this.previousTime),this.previousTime=o-m%this.interval;this.cycles<=t.GPU.CyclesPerFrame;){const b=this.cpu.tick();this.gpu.tick(b),this.apu.tick(b),this.cycles+=b}d.controllerManager.queryButtons(),this.frameFinishedCallback&&this.frameFinishedCallback(this.gpu.screen,this.fps,this.cpu.registers),this.cycles=this.cycles%t.GPU.CyclesPerFrame}requestAnimationFrame(b=>this.runFrame(b))}onFrameFinished(o){this.frameFinishedCallback=o}loadGame(o){const m=u.CartridgeLoader.FromArrayBuffer(o);i.memory.insertCartridge(m),console.log("title: "+m.title),console.log("version: "+m.versionNumber),console.log("type: "+m.typeName),console.log("rom size: "+m.romSize),console.log("ram size: "+m.ramSize)}setCartridgeSaveRam(o){var m;(((m=i.memory.cartridge)==null?void 0:m.type)===c.CartridgeType.MBC1_RAM_BATTERY||c.CartridgeType.MBC3_RAM_BATTERY)&&i.memory.cartridge.setRam(o)}getCartridgeSaveRam(){var o;if(((o=i.memory.cartridge)==null?void 0:o.type)===c.CartridgeType.MBC1_RAM_BATTERY||c.CartridgeType.MBC3_RAM_BATTERY)return i.memory.cartridge.dumpRam()}setOnWriteToCartridgeRam(o){var m;(((m=i.memory.cartridge)==null?void 0:m.type)===c.CartridgeType.MBC1_RAM_BATTERY||c.CartridgeType.MBC3_RAM_BATTERY)&&(i.memory.cartridge.onSramWrite=o)}get cartridge(){return i.memory.cartridge}}})(),p})()})})(Tt);function Ai({game:l}){const a=new Tt.exports.Gameboy,y=Ke.exports.useRef(null);return Ke.exports.useEffect(function(){fetch(l.executable).then(g=>g.arrayBuffer()).then(g=>{a.loadGame(g),a.apu.enableSound();const v=y.current.getContext("2d");a.onFrameFinished(p=>v==null?void 0:v.putImageData(p,0,0)),a.run()})},[l.hash]),ge("canvas",{width:"160",height:"144",ref:y,style:{width:"100vw",imageRendering:"pixelated"}})}function Pi(){const{game:l,hash:a}=wi.parse(location.search.substring(1)),y=et(atob(l.toString()),36)===a,g=JSON.parse(atob(l.toString())),v=g.executable.split(".").pop(),p={...g,id:et(g.name).toString(),hash:a==null?void 0:a.toString(),signed:y.toString(),ext:v};return p.type==="GAMEBOY"?ge(Ai,{game:p}):ge("pre",{children:ge("code",{children:JSON.stringify(p,null,4)})})}Et(document.getElementById("runner-root")).render(ge(Pi,{}));
